<html lang="en" class="wf-inconsolata-n5-active wf-jaffacitweb-i3-active wf-jaffacitweb-i4-active wf-jaffacitweb-i7-active wf-jaffacitweb-n3-active wf-jaffacitweb-n4-active wf-jaffacitweb-n7-active wf-active js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta name="author" content=""><title>11.1.0 API Reference</title><link rel="icon" type="image/png" href="http://hapijs.com/public/img/favicon.png"><link rel="stylesheet" href="http://hapijs.com/public/css/plugins/normalize.css"><link rel="stylesheet" href="http://hapijs.com/public/css/main.css"><style type="text/css"></style><style type="text/css">.tk-inconsolata{font-family:"inconsolata",sans-serif;}.tk-jaf-facitweb{font-family:"jaf-facitweb",sans-serif;}</style><link rel="stylesheet" href="http://use.typekit.net/c/51f4cf/1w;inconsolata,2,XH2:P:n5;jaf-facitweb,2,Y1j:P:i3,Y1k:P:i4,Y1p:P:i7,Y1h:P:n3,Y1d:P:n4,Y1n:P:n7/d?3bb2a6e53c9684ffdc9a9bf01d5b2a62a6cf22dd8069c1189991f709ebf53be00009a2e3673be2c54955fc106a339557b73cf43dd742c3c73bcc4674f7300b8cf1e189e3898e7922764c8bf7e098491133edadb935a55be87074c3910a449822f86925dfe8002ee40fa018b4beee0ffafc2c369bc07f35b1a14749234ade72c584d64dfe35d4f2b052c850dabf1a3ef7088b4f246df9e01bb97488f8093984fa1891bbfec48bc3"></head><body><header role="banner"><nav role="navigation" class="animated fadeInDown"><div class="content cf"><a href="/" title="&#x2190; Back to home of hapi" class="logo"></a><a href="#" class="nav-toggle" aria-hidden="true"></a><ul class="nav-collapse unstyled nav-collapse-0 closed" aria-hidden="false" style="transition: max-height 284ms; position: relative;"><li> <a href="/updates" title="Updates">Updates</a></li><li> <a href="/tutorials" title="Tutorials">Tutorials</a></li><li><a href="/api" title="API Reference">API</a></li><li><a href="/community" title="Community">Community</a></li><li><a href="/plugins" title="Plugins">Plugins</a></li><li><a href="/contribute" title="Contribute to hapi">Contribute</a></li><li> <a href="/resources" title="Resources">Resources</a></li><li><a href="/help">Need Help?</a></li></ul></div></nav></header><div class="content page-api cf"><div class="column api-description api-reference"><div class="reference"><div class="announce instapaper_body md" data-path="API.md" id="file"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1><a id="111x-api-reference" class="anchor" href="#111x-api-reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>11.1.x API Reference</h1>



<h2><a id="server" class="anchor" href="#server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server</h2>

<p>The <code>Server</code> object is the main application container. The server manages all incoming connections
along with all the facilities provided by the framework. A server can contain more than one
connection (e.g. listen to port <code>80</code> and <code>8080</code>).</p>

<h3><a id="new-serveroptions" class="anchor" href="#new-serveroptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>new Server([options])</code></h3>

<p>Creates a new <code>Server</code> object where:</p>

<ul>
<li><p><code>options</code> - optional configuration:</p>

<ul>
<li><p><code>app</code> - application-specific configuration which can later be accessed via
<code>server.settings.app</code>. Note the difference between <code>server.settings.app</code> which is
used to store static configuration values and <a href="#serverapp" id=""><code>server.app</code></a> which is meant for
storing run-time state. Defaults to <code>{}</code>.</p></li>
<li><p><a name="user-content-server.config.cache" id=""></a><code>cache</code> - sets up server-side caching. Every server
includes a default cache for storing application state. By default, a simple memory-based
cache is created which has limited capacity and capabilities. <strong>hapi</strong> uses
<a href="https://github.com/hapijs/catbox" id=""><strong>catbox</strong></a> for its cache which includes support for
common storage solutions (e.g. Redis, MongoDB, Memcached, and Riak). Caching is only utilized
if methods and <a href="#plugins" id="">plugins</a> explicitly store their state in the cache. The server
cache configuration only defines the storage container itself. <code>cache</code> can be assigned:</p>

<ul>
<li>a prototype function (usually obtained by calling <code>require()</code> on a <strong>catbox</strong> strategy
such as <code>require(&apos;catbox-redis&apos;)</code>).</li>
<li>a configuration object with the following options:

<ul>
<li><code>engine</code> - a prototype function or <strong>catbox</strong> engine object.</li>
<li><code>name</code> - an identifier used later when provisioning or configuring caching for
<a href="#servermethodname-method-options" id="">server methods</a> or <a href="#plugins" id="">plugins</a>. Each cache
name must be unique. A single item may omit the <code>name</code> option which defines the
default cache. If every cache includes a <code>name</code>, a default memory cache is provisions
as well.</li>
<li><code>shared</code> - if <code>true</code>, allows multiple cache users to share the same segment (e.g.
multiple methods using the same cache storage container). Default to <code>false</code>.</li>
<li>other options passed to the <strong>catbox</strong> strategy used.</li>
</ul></li>
<li>an array of the above object for configuring multiple cache instances, each with a unique
name. When an array of objects is provided, multiple cache connections are established
and each array item (except one) must include a <code>name</code>.</li>
</ul></li>
<li><p><a name="user-content-server.config.connections" id=""></a><code>connections</code> - sets the default connections
configuration which can be overridden by each connection where:</p>

<ul>
<li><p><code>app</code> - application-specific connection configuration which can be accessed via
<code>connection.settings.app</code>. Provides a safe place to store application configuration
without potential conflicts with the framework internals. Should not be used to configure
<a href="#plugins" id="">plugins</a> which should use <code>plugins[name]</code>. Note the difference between
<code>connection.settings.app</code> which is used to store configuration values and
<code>connection.app</code> which is meant for storing run-time state.</p></li>
<li><p><code>compression</code> - if <code>false</code>, response content encoding is disable. Defaults to <code>true</code>.</p></li>
<li><p><code>load</code> - connection load limits configuration where:</p>

<ul>
<li><code>maxHeapUsedBytes</code> - maximum V8 heap size over which incoming requests are rejected
with an HTTP Server Timeout (503) response. Defaults to <code>0</code> (no limit).</li>
<li><code>maxRssBytes</code> - maximum process RSS size over which incoming requests are rejected
with an HTTP Server Timeout (503) response. Defaults to <code>0</code> (no limit).</li>
<li><code>maxEventLoopDelay</code> - maximum event loop delay duration in milliseconds over which
incoming requests are rejected with an HTTP Server Timeout (503) response. Defaults
to <code>0</code> (no limit).</li>
</ul></li>
<li><p><code>plugins</code> - plugin-specific configuration which can later be accessed via
<code>connection.settings.plugins</code>. Provides a place to store and pass connection-specific
 plugin configuration. <code>plugins</code> is an object where each key is a plugin name and the
 value is the configuration. Note the difference between <code>connection.settings.plugins</code>
 which is used to store configuration values and <code>connection.plugins</code> which is meant for
 storing run-time state.</p></li>
<li><p><code>query</code> - incoming request query component parsing options:</p>

<ul>
<li><code>qs</code> - optional URI parsing <a href="https://www.npmjs.com/package/qs#parsing-objects" id="">options</a>.
Defaults to the <strong>qs</strong> module parsing defaults.</li>
</ul></li>
<li><p><a name="user-content-connection.config.router" id=""></a><code>router</code> - controls how incoming request URIs are
matched against the routing table:</p>

<ul>
<li><code>isCaseSensitive</code> - determines whether the paths &apos;/example&apos; and &apos;/EXAMPLE&apos; are
considered different resources. Defaults to <code>true</code>.</li>
<li><code>stripTrailingSlash</code> - removes trailing slashes on incoming paths. Defaults to
<code>false</code>.</li>
</ul></li>
<li><p><code>routes</code> - a <a href="#route-options" id="">route options</a> object used to set the default configuration
for every route.</p></li>
<li><p><code>state</code> - sets the default configuration for every state (cookie) set explicitly via
<a href="#serverstatename-options" id=""><code>server.state()</code></a> or implicitly (without definition) using
the <a href="#serverstatename-options" id="">state configuration</a> object.</p></li>
</ul></li>
<li><p><code>debug</code> - determines which logged events are sent to the console (this should only be used
for development and does not affect which events are actually logged internally and
recorded). Set to <code>false</code> to disable all console logging, or to an object with:</p>

<ul>
<li><code>log</code> - a string array of server log tags to be displayed via <code>console.error()</code> when
the events are logged via <a href="#serverlogtags-data-timestamp" id=""><code>server.log()</code></a> as well as
internally generated <a href="#server-logs" id="">server logs</a>. For example, to display all errors,
set the option to <code>[&apos;error&apos;]</code>. To turn off all console debug messages set it to <code>false</code>.
Defaults to uncaught errors thrown in external code (these errors are handled
automatically and result in an Internal Server Error response) or runtime errors due to
developer error.</li>
<li><code>request</code> - a string array of request log tags to be displayed via <code>console.error()</code> when
the events are logged via <a href="#requestlogtags-data-timestamp" id=""><code>request.log()</code></a> as well as
internally generated <a href="#request-logs" id="">request logs</a>. For example, to display all errors,
set the option to <code>[&apos;error&apos;]</code>. To turn off all console debug messages set it to <code>false</code>.
Defaults to uncaught errors thrown in external code (these errors are handled
automatically and result in an Internal Server Error response) or runtime errors due to
developer error.</li>
</ul></li>
<li><p><code>load</code> - process load monitoring where:</p>

<ul>
<li><code>sampleInterval</code> - the frequency of sampling in milliseconds. Defaults to <code>0</code> (no
sampling).</li>
</ul></li>
<li><p><code>mime</code> - options passed to the <a href="https://github.com/hapijs/mimos" id=""><strong>mimos</strong></a> module when
generating the mime database used by the server and accessed via
<a href="#servermime" id=""><code>server.mime</code></a>.</p></li>
<li><p><code>plugins</code> - plugin-specific configuration which can later be accessed via
<code>server.settings.plugins</code>. <code>plugins</code> is an object where each key is a plugin name and the
value is the configuration. Note the difference between <code>server.settings.plugins</code> which is
used to store static configuration values and <a href="#serverplugins" id=""><code>server.plugins</code></a> which is
meant for storing run-time state. Defaults to <code>{}</code>.</p></li>
<li><p><code>useDomains</code> - if <code>false</code>, will not use node domains to protect against exceptions thrown in
handlers and other external code. Defaults to <code>true</code>.</p></li>
</ul></li>
</ul>

<p>Note that the <code>options</code> object is deeply cloned and cannot contain any values that are unsafe to
perform deep copy on.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>({
    cache<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>catbox-redis<span class="pl-pds">&apos;</span></span>),
    load<span class="pl-k">:</span> {
        sampleInterval<span class="pl-k">:</span> <span class="pl-c1">1000</span>
    }
});</pre></div>

<h3><a id="server-properties" class="anchor" href="#server-properties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server properties</h3>

<h4><a id="serverapp" class="anchor" href="#serverapp" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.app</code></h4>

<p>Provides a safe place to store server-specific run-time application data without potential
conflicts with the framework internals. The data can be accessed whenever the server is
accessible. Initialized with an empty object.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
server <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.app.key <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&apos;</span>value<span class="pl-pds">&apos;</span></span>;

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(request.server.app.key);
};</pre></div>

<h4><a id="serverconnections" class="anchor" href="#serverconnections" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.connections</code></h4>

<p>An array containing the server&apos;s connections. When the server object is returned from
<a href="#serverselectlabels" id=""><code>server.select()</code></a>, the <code>connections</code> array only includes the connections
matching the selection criteria.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span>, labels<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>a<span class="pl-pds">&apos;</span></span> });
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">8080</span>, labels<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>b<span class="pl-pds">&apos;</span></span> });

<span class="pl-c">// server.connections.length === 2</span>

<span class="pl-k">const</span> <span class="pl-c1">a</span> <span class="pl-k">=</span> server.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>a<span class="pl-pds">&apos;</span></span>);

<span class="pl-c">// a.connections.length === 1</span></pre></div>

<h4><a id="serverinfo" class="anchor" href="#serverinfo" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.info</code></h4>

<p>When the server contains exactly one connection, <code>info</code> is an object containing information about
the sole connection where:</p>

<ul>
<li><code>id</code> - a unique connection identifier (using the format &apos;{hostname}:{pid}:{now base36}&apos;).</li>
<li><code>created</code> - the connection creation timestamp.</li>
<li><code>started</code> - the connection start timestamp (<code>0</code> when stopped).</li>
<li><code>port</code> - the connection port based on the following rules:

<ul>
<li>the configured port value before the server has been started.</li>
<li>the actual port assigned when no port is configured or set to <code>0</code> after the server has been
started.</li>
</ul></li>
<li><code>host</code> - the host name the connection was configured to. Defaults to the operating system
hostname when available, otherwise <code>&apos;localhost&apos;</code>.</li>
<li><code>address</code> - the active IP address the connection was bound to after starting. Set to <code>undefined</code>
until the server has been started or when using a non TCP port (e.g. UNIX domain socket).</li>
<li><code>protocol</code> - the protocol used:

<ul>
<li><code>&apos;http&apos;</code> - HTTP.</li>
<li><code>&apos;https&apos;</code> - HTTPS.</li>
<li><code>&apos;socket&apos;</code> - UNIX domain socket or Windows named pipe.</li>
</ul></li>
<li><code>uri</code> - a string representing the connection (e.g. &apos;<a href="http://example.com:8080" id="">http://example.com:8080</a>&apos; or
&apos;socket:/unix/domain/socket/path&apos;). Contains the <code>uri</code> setting if provided, otherwise constructed
from the available settings. If no <code>port</code> is available or set to <code>0</code>, the <code>uri</code> will not include
a port component.</li>
</ul>

<p>When the server contains more than one connection, each <a href="#serverconnections" id=""><code>server.connections</code></a>
array member provides its own <code>connection.info</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-c">// server.info.port === 80</span>

server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">8080</span> });

<span class="pl-c">// server.info === null</span>
<span class="pl-c">// server.connections[1].info.port === 8080</span></pre></div>

<h4><a id="serverload" class="anchor" href="#serverload" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.load</code></h4>

<p>An object containing the process load metrics (when <code>load.sampleInterval</code> is enabled):</p>

<ul>
<li><code>eventLoopDelay</code> - event loop delay milliseconds.</li>
<li><code>heapUsed</code> - V8 heap usage.</li>
<li><code>rss</code> - RSS memory usage.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>({ load<span class="pl-k">:</span> { sampleInterval<span class="pl-k">:</span> <span class="pl-c1">1000</span> } });

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(server.load.rss);</pre></div>

<h4><a id="serverlistener" class="anchor" href="#serverlistener" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.listener</code></h4>

<p>When the server contains exactly one connection, <code>listener</code> is the node HTTP server object of the
sole connection.</p>

<p>When the server contains more than one connection, each <a href="#serverconnections" id=""><code>server.connections</code></a>
array member provides its own <code>connection.listener</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">SocketIO</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>socket.io<span class="pl-pds">&apos;</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">io</span> <span class="pl-k">=</span> SocketIO.listen(server.listener);
io.sockets.on(<span class="pl-s"><span class="pl-pds">&apos;</span>connection<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">socket</span>)<span class="pl-k"> =&gt;</span> {

    socket.emit({ msg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>welcome<span class="pl-pds">&apos;</span></span> });
});</pre></div>

<h4><a id="servermethods" class="anchor" href="#servermethods" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.methods</code></h4>

<p>An object providing access to the <a href="#servermethodname-method-options" id="">server methods</a> where each
server method name is an object property.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();

<span class="pl-k">const</span> <span class="pl-c1">add</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">a</span>, <span class="pl-smi">b</span>, <span class="pl-smi">next</span>) {

    <span class="pl-k">return</span> next(<span class="pl-c1">null</span>, a <span class="pl-k">+</span> b);
};

server.<span class="pl-c1">method</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>add<span class="pl-pds">&apos;</span></span>, add);

server.methods.<span class="pl-c1">add</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, (<span class="pl-smi">err</span>, <span class="pl-smi">result</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-c">// result === 3</span>
});</pre></div>

<h4><a id="servermime" class="anchor" href="#servermime" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.mime</code></h4>

<p>Provides access to the server MIME database used for setting content-type information. The object
must not be modified directly but only through the <code>mime</code> server setting.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">options</span> <span class="pl-k">=</span> {
    mime<span class="pl-k">:</span> {
        override<span class="pl-k">:</span> {
            <span class="pl-s"><span class="pl-pds">&apos;</span>node/module<span class="pl-pds">&apos;</span></span><span class="pl-k">:</span> {
                source<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>steve<span class="pl-pds">&apos;</span></span>,
                compressible<span class="pl-k">:</span> <span class="pl-c1">false</span>,
                extensions<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">&apos;</span>node<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>module<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>npm<span class="pl-pds">&apos;</span></span>],
                type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>node/module<span class="pl-pds">&apos;</span></span>
            }
        }
    }
};

<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>(options);
<span class="pl-c">// server.mime.path(&apos;code.js&apos;).type === &apos;application/javascript&apos;</span>
<span class="pl-c">// server.mime.path(&apos;file.npm&apos;).type === &apos;node/module&apos;</span></pre></div>

<h4><a id="serverplugins" class="anchor" href="#serverplugins" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.plugins</code></h4>

<p>An object containing the values exposed by each plugin registered where each key is a plugin name
and the values are the exposed properties by each plugin using
<a href="#serverexposekey-value" id=""><code>server.expose()</code></a>. Plugins may set the value of the
<code>server.plugins[name]</code> object directly or via the <code>server.expose()</code> method.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    server.expose(<span class="pl-s"><span class="pl-pds">&apos;</span>key<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>value<span class="pl-pds">&apos;</span></span>);
    <span class="pl-c">// server.plugins.example.key === &apos;value&apos;</span>
    <span class="pl-k">return</span> next();
};

<span class="pl-c1">exports</span>.register.<span class="pl-c1">attributes</span> <span class="pl-k">=</span> {
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>example<span class="pl-pds">&apos;</span></span>
};</pre></div>

<h4><a id="serverrealm" class="anchor" href="#serverrealm" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.realm</code></h4>

<p>The realm object contains server-wide or plugin-specific state that can be shared across various
methods. For example, when calling <a href="#serverbindcontext" id=""><code>server.bind()</code></a>, the active realm
<code>settings.bind</code> property is set which is then used by routes and extensions added at the same level
(server root or plugin). Realms are a limited version of a sandbox where plugins can maintain state
used by the framework when adding routes, extensions, and other properties.</p>

<ul>
<li><code>modifiers</code> - when the server object is provided as an argument to the plugin <code>register()</code>
method, <code>modifiers</code> provides the registration preferences passed the
<a href="#serverregisterplugins-options-callback" id=""><code>server.register()</code></a> method and includes:

<ul>
<li><code>route</code> - routes preferences:

<ul>
<li><code>prefix</code> - the route path prefix used by any calls to <a href="#serverrouteoptions" id=""><code>server.route()</code></a>
from the server. Note that if a prefix is used and the route path is set to <code>&apos;/&apos;</code>, the
resulting path will not include the trailing slash.</li>
<li><code>vhost</code> - the route virtual host settings used by any calls to
<a href="#serverrouteoptions" id=""><code>server.route()</code></a> from the server.</li>
</ul></li>
</ul></li>
<li><code>plugin</code> - the active plugin name (empty string if at the server root).</li>
<li><code>pluginOptions</code> - the plugin options object passed at registration.</li>
<li><code>plugins</code> - plugin-specific state to be shared only among activities sharing the same active
state. <code>plugins</code> is an object where each key is a plugin name and the value is the plugin state.</li>
<li><code>settings</code> - settings overrides:

<ul>
<li><code>files.relativeTo</code></li>
<li><code>bind</code></li>
</ul></li>
</ul>

<p>The <code>server.realm</code> object should be considered read-only and must not be changed directly except
for the <code>plugins</code> property which can be directly manipulated by each plugin, setting its properties
inside <code>plugins[name]</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(server.realm.modifiers.route.<span class="pl-c1">prefix</span>);
    <span class="pl-k">return</span> next();
};</pre></div>

<h4><a id="serverregistrations" class="anchor" href="#serverregistrations" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.registrations</code></h4>

<p>When the server contains exactly one connection, <code>registrations</code> is an object where each key is a
registered plugin name and value contains:</p>

<ul>
<li><code>version</code> - the plugin version.</li>
<li><code>name</code> - the plugin name.</li>
<li><code>options</code> - options used to register the plugin.</li>
<li><code>attributes</code> - plugin registration attributes.</li>
</ul>

<p>When the server contains more than one connection, each <a href="#serverconnections" id=""><code>server.connections</code></a>
array member provides its own <code>connection.registrations</code>.</p>

<h4><a id="serverroot" class="anchor" href="#serverroot" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.root</code></h4>

<p>The root server object containing all the connections and the root server methods (e.g. <code>start()</code>,
<code>stop()</code>, <code>connection()</code>).</p>

<h4><a id="serversettings" class="anchor" href="#serversettings" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.settings</code></h4>

<p>The server configuration object after defaults applied.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>({
    app<span class="pl-k">:</span> {
        key<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>value<span class="pl-pds">&apos;</span></span>
    }
});

<span class="pl-c">// server.settings.app === { key: &apos;value&apos; }</span></pre></div>

<h4><a id="serverversion" class="anchor" href="#serverversion" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.version</code></h4>

<p>The <strong>hapi</strong> module version number.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
<span class="pl-c">// server.version === &apos;8.0.0&apos;</span></pre></div>

<h3><a id="serverauthdefaultoptions" class="anchor" href="#serverauthdefaultoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.auth.default(options)</code></h3>

<p>Sets a default strategy which is applied to every route where:</p>

<ul>
<li><code>options</code> - a string with the default strategy name or an object with a specified strategy or
strategies using the same format as the <a href="#route.config.auth" id="">route <code>auth</code> handler options</a>.</li>
</ul>

<p>The default does not apply when the route config specifies <code>auth</code> as <code>false</code>, or has an
authentication strategy configured. Otherwise, the route authentication config is applied to the
defaults.</p>

<p>Note that if the route has authentication config, the default only applies at the time of adding
the route, not at runtime. This means that calling <code>default()</code> after adding a route with some
authentication config will have no impact on the routes added prior. However, the default will
apply to routes added before <code>default()</code> is called if those routes lack any authentication config.</p>

<p>The default auth strategy configuration can be accessed via <code>connection.auth.settings.default</code>. To
obtain the active authentication configuration of a route, use <code>connection.auth.lookup(request.route)</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.auth.<span class="pl-c1">scheme</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>, scheme);
server.auth.strategy(<span class="pl-s"><span class="pl-pds">&apos;</span>default<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>);
server.auth.default(<span class="pl-s"><span class="pl-pds">&apos;</span>default<span class="pl-pds">&apos;</span></span>);

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply(request.auth.credentials.user);
    }
});</pre></div>

<h3><a id="serverauthschemename-scheme" class="anchor" href="#serverauthschemename-scheme" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.auth.scheme(name, scheme)</code></h3>

<p>Registers an authentication scheme where:</p>

<ul>
<li><code>name</code> - the scheme name.</li>
<li><code>scheme</code> - the method implementing the scheme with signature <code>function(server, options)</code> where:

<ul>
<li><code>server</code> - a reference to the server object the scheme is added to.</li>
<li><code>options</code> - optional scheme settings used to instantiate a strategy.</li>
</ul></li>
</ul>

<p>The <code>scheme</code> method must return an object with the following keys:</p>

<ul>
<li><code>authenticate(request, reply)</code> - required function called on each incoming request configured
with the authentication scheme where:

<ul>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>reply</code> - the <a href="#reply-interface" id="">reply interface</a> the authentication method must call when
done authenticating the request where:

<ul>
<li><code>reply(err, response, result)</code> - is called if authentication failed where:

<ul>
<li><code>err</code> - any authentication error.</li>
<li><code>response</code> - any authentication response action such as redirection. Ignored if <code>err</code>
is present, otherwise required.</li>
<li><code>result</code> - an object containing:

<ul>
<li><code>credentials</code> - the authenticated credentials.</li>
<li><code>artifacts</code> - optional authentication artifacts.</li>
</ul></li>
</ul></li>
<li><code>reply.continue(result)</code> - is called if authentication succeeded where:

<ul>
<li><code>result</code> - same object as <code>result</code> above.</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>payload(request, reply)</code> - optional function called to authenticate the request payload where:

<ul>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>reply(err, response)</code> - is called if authentication failed where:

<ul>
<li><code>err</code> - any authentication error.</li>
<li><code>response</code> - any authentication response action such as redirection. Ignored if <code>err</code>
is present, otherwise required.</li>
</ul></li>
<li><code>reply.continue()</code> - is called if payload authentication succeeded.</li>
</ul></li>
<li><code>response(request, reply)</code> - optional function called to decorate the response with
authentication headers before the response headers or payload is written where:

<ul>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>reply(err, response)</code> - is called if an error occurred where:

<ul>
<li><code>err</code> - any authentication error.</li>
<li><code>response</code> - any authentication response to send instead of the current response. Ignored
if <code>err</code> is present, otherwise required.</li>
</ul></li>
<li><code>reply.continue()</code> - is called if the operation succeeded.</li>
</ul></li>
<li><code>options</code> - an optional object with the following keys:

<ul>
<li><code>payload</code> - if <code>true</code>, requires payload validation as part of the scheme and forbids routes
from disabling payload auth validation. Defaults to <code>false</code>.</li>
</ul></li>
</ul>

<p>When the scheme <code>authenticate()</code> method implementation calls <code>reply()</code> with an error condition,
the specifics of the error affect whether additional authentication strategies will be attempted
if configured for the route. If the <code>err</code> returned by the <code>reply()</code> method includes a message, no
additional strategies will be attempted. If the <code>err</code> does not include a message but does include
a scheme name (e.g. <code>Boom.unauthorized(null, &apos;Custom&apos;)</code>), additional strategies will be attempted
in order of preference.</p>

<p>When the scheme <code>payload()</code> method returns an error with a message, it means payload validation
failed due to bad payload. If the error has no message but includes a scheme name (e.g.
<code>Boom.unauthorized(null, &apos;Custom&apos;)</code>), authentication may still be successful if the route
<code>auth.payload</code> configuration is set to <code>&apos;optional&apos;</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">scheme</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>) {

    <span class="pl-k">return</span> {
        <span class="pl-en">authenticate</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">const</span> <span class="pl-c1">req</span> <span class="pl-k">=</span> request.raw.req;
            <span class="pl-k">const</span> <span class="pl-c1">authorization</span> <span class="pl-k">=</span> req.<span class="pl-c1">headers</span>.authorization;
            <span class="pl-k">if</span> (<span class="pl-k">!</span>authorization) {
                <span class="pl-k">return</span> reply(Boom.unauthorized(<span class="pl-c1">null</span>, <span class="pl-s"><span class="pl-pds">&apos;</span>Custom<span class="pl-pds">&apos;</span></span>));
            }

            <span class="pl-k">return</span> reply.continue({ credentials<span class="pl-k">:</span> { user<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>john<span class="pl-pds">&apos;</span></span> } });
        }
    };
};

server.auth.<span class="pl-c1">scheme</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>, scheme);</pre></div>

<h3><a id="serverauthstrategyname-scheme-mode-options" class="anchor" href="#serverauthstrategyname-scheme-mode-options" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.auth.strategy(name, scheme, [mode], [options])</code></h3>

<p>Registers an authentication strategy where:</p>

<ul>
<li><code>name</code> - the strategy name.</li>
<li><code>scheme</code> - the scheme name (must be previously registered using
<a href="#serverauthschemename-scheme" id=""><code>server.auth.scheme()</code></a>).</li>
<li><code>mode</code> - if <code>true</code>, the scheme is automatically assigned as a required strategy to any route
without an <code>auth</code> config. Can only be assigned to a single server strategy. Value must be <code>true</code>
(which is the same as <code>&apos;required&apos;</code>) or a valid authentication mode (<code>&apos;required&apos;</code>, <code>&apos;optional&apos;</code>,
<code>&apos;try&apos;</code>). Defaults to <code>false</code>.</li>
<li><code>options</code> - scheme options based on the scheme requirements.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.auth.<span class="pl-c1">scheme</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>, scheme);
server.auth.strategy(<span class="pl-s"><span class="pl-pds">&apos;</span>default<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>);

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    config<span class="pl-k">:</span> {
        auth<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>default<span class="pl-pds">&apos;</span></span>,
        <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">return</span> reply(request.auth.credentials.user);
        }
    }
});</pre></div>

<h3><a id="serverauthteststrategy-request-next" class="anchor" href="#serverauthteststrategy-request-next" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.auth.test(strategy, request, next)</code></h3>

<p>Tests a request against an authentication strategy where:</p>

<ul>
<li><code>strategy</code> - the strategy name registered with
<a href="#serverauthstrategyname-scheme-mode-options" id=""><code>server.auth.strategy()</code></a>.</li>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>next</code> - the callback function with signature <code>function(err, credentials)</code> where:

<ul>
<li><code>err</code> - the error if authentication failed.</li>
<li><code>credentials</code> - the authentication credentials object if authentication was successful.</li>
</ul></li>
</ul>

<p>Note that the <code>test()</code> method does not take into account the route authentication configuration. It
also does not perform payload authentication. It is limited to the basic strategy authentication
execution. It does not include verifying scope, entity, or other route properties.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.auth.<span class="pl-c1">scheme</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>, scheme);
server.auth.strategy(<span class="pl-s"><span class="pl-pds">&apos;</span>default<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>custom<span class="pl-pds">&apos;</span></span>);

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        request.server.auth.<span class="pl-c1">test</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>default<span class="pl-pds">&apos;</span></span>, request, (<span class="pl-smi">err</span>, <span class="pl-smi">credentials</span>)<span class="pl-k"> =&gt;</span> {

            <span class="pl-k">if</span> (err) {
                <span class="pl-k">return</span> reply({ status<span class="pl-k">:</span> <span class="pl-c1">false</span> });
            }

            <span class="pl-k">return</span> reply({ status<span class="pl-k">:</span> <span class="pl-c1">true</span>, user<span class="pl-k">:</span> credentials.<span class="pl-c1">name</span> });
        });
    }
});</pre></div>

<h3><a id="serverbindcontext" class="anchor" href="#serverbindcontext" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.bind(context)</code></h3>

<p>Sets a global context used as the default bind object when adding a route or an extension where:</p>

<ul>
<li><code>context</code> - the object used to bind <code>this</code> in handler and
<a href="#serverextevent-method-options" id="">extension methods</a>.</li>
</ul>

<p>When setting context inside a plugin, the context is applied only to methods set up by the plugin.
Note that the context applies only to routes and extensions added after it has been set. Ignored if
the method being bound is an arrow function.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-v">this</span>.message);
};

<span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">bind</span> <span class="pl-k">=</span> {
        message<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>hello<span class="pl-pds">&apos;</span></span>
    };

    server.bind(bind);
    server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> handler });
    <span class="pl-k">return</span> next();
};</pre></div>

<h3><a id="servercacheoptions" class="anchor" href="#servercacheoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.cache(options)</code></h3>

<p>Provisions a cache segment within the server cache facility where:</p>

<ul>
<li><code>options</code> - <a href="https://github.com/hapijs/catbox#policy" id=""><strong>catbox</strong> policy</a> configuration where:

<ul>
<li><code>expiresIn</code> - relative expiration expressed in the number of milliseconds since the item was
saved in the cache. Cannot be used together with <code>expiresAt</code>.</li>
<li><code>expiresAt</code> - time of day expressed in 24h notation using the &apos;HH:MM&apos; format, at which point
all cache records expire. Uses local time. Cannot be used together with <code>expiresIn</code>.</li>
<li><code>generateFunc</code> - a function used to generate a new cache item if one is not found in the
cache when calling <code>get()</code>. The method&apos;s signature is <code>function(id, next)</code> where:
    - <code>id</code> - the <code>id</code> string or object provided to the <code>get()</code> method.
    - <code>next</code> - the method called when the new item is returned with the signature
      <code>function(err, value, ttl)</code> where:
        - <code>err</code> - an error condition.
        - <code>value</code> - the new value generated.
        - <code>ttl</code> - the cache ttl value in milliseconds. Set to <code>0</code> to skip storing in the
          cache. Defaults to the cache global policy.</li>
<li><code>staleIn</code> - number of milliseconds to mark an item stored in cache as stale and attempt to
regenerate it when <code>generateFunc</code> is provided. Must be less than <code>expiresIn</code>.</li>
<li><code>staleTimeout</code> - number of milliseconds to wait before checking if an item is stale.</li>
<li><code>generateTimeout</code> - number of milliseconds to wait before returning a timeout error when the
<code>generateFunc</code> function takes too long to return a value. When the value is eventually
returned, it is stored in the cache for future requests. Required if <code>generateFunc</code> is
present. Set to <code>false</code> to disable timeouts which may cause all <code>get()</code> requests to get stuck
forever.</li>
<li><code>generateOnReadError</code> - if <code>false</code>, an upstream cache read error will stop the <code>cache.get()</code>
method from calling the generate function and will instead pass back the cache error. Defaults
to <code>true</code>.</li>
<li><code>generateIgnoreWriteError</code> - if <code>false</code>, an upstream cache write error when calling
<code>cache.get()</code> will be passed back with the generated value when calling. Defaults to <code>true</code>.</li>
<li><code>cache</code> - the cache name configured in <a href="#server.config.cache" id="">&apos;server.cache`</a>. Defaults to
the default cache.</li>
<li><code>segment</code> - string segment name, used to isolate cached items within the cache partition.
When called within a plugin, defaults to &apos;!name&apos; where &apos;name&apos; is the plugin name. When called
within a server method, defaults to &apos;#name&apos; where &apos;name&apos; is the server method name. Required
when called outside of a plugin.</li>
<li><code>shared</code> - if <code>true</code>, allows multiple cache provisions to share the same segment. Default to
<code>false</code>.</li>
</ul></li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">cache</span> <span class="pl-k">=</span> server.cache({ segment<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>countries<span class="pl-pds">&apos;</span></span>, expiresIn<span class="pl-k">:</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">1000</span> });
cache.set(<span class="pl-s"><span class="pl-pds">&apos;</span>norway<span class="pl-pds">&apos;</span></span>, { capital<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>oslo<span class="pl-pds">&apos;</span></span> }, <span class="pl-c1">null</span>, (<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {

    cache.get(<span class="pl-s"><span class="pl-pds">&apos;</span>norway<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">err</span>, <span class="pl-smi">value</span>, <span class="pl-smi">cached</span>, <span class="pl-smi">log</span>)<span class="pl-k"> =&gt;</span> {

        <span class="pl-c">// value === { capital: &apos;oslo&apos; };</span>
    });
});</pre></div>

<h3><a id="serverconnectionoptions" class="anchor" href="#serverconnectionoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.connection([options])</code></h3>

<p>Adds an incoming server connection where:</p>

<ul>
<li><code>host</code> - the public hostname or IP address. Used only to set <code>server.info.host</code> and
<code>server.info.uri</code>. If not configured, defaults to the operating system hostname and if not
available, to <code>&apos;localhost&apos;</code>.</li>
<li><code>address</code> - sets the host name or IP address the connection will listen on. If not configured,
defaults to <code>host</code> if present, otherwise to all available network interfaces (i.e. <code>&apos;0.0.0.0&apos;</code>).
Set to <code>127.0.0.1</code> or <code>localhost</code> to restrict connection to only those coming from the same
machine.</li>
<li><code>port</code> - the TCP port the connection will listen to. Defaults to an ephemeral port (<code>0</code>) which
uses an available port when the server is started (and assigned to <code>server.info.port</code>). If <code>port</code>
is a string containing a &apos;/&apos; character, it is used as a UNIX domain socket path and if it starts
with &apos;\.\pipe&apos; as a Windows named pipe.</li>
<li><code>uri</code> - the full public URI without the path (e.g. &apos;<a href="http://example.com:8080" id="">http://example.com:8080</a>&apos;). If present, used
as the connection <code>info.uri</code> otherwise constructed from the connection settings.</li>
<li><code>listener</code> - optional node.js HTTP (or HTTPS)
<a href="http://nodejs.org/api/http.html#http_class_http_server" id=""><code>http.Server</code></a> object or any compatible
object. If the <code>listener</code> needs to be manually started, set <code>autoListen</code> to <code>false</code>. If the
<code>listener</code> uses TLS, set <code>tls</code> to <code>true</code>.</li>
<li><code>autoListen</code> - indicates that the <code>connection.listener</code> will be started manually outside the
framework. Cannot be specified with a <code>port</code> setting. Defaults to <code>true</code>.</li>
<li><code>labels</code> - a string or string array of labels used to <a href="#serverselectlabels" id=""><code>server.select()</code></a>
specific connections matching the specified labels. Defaults to an empty array <code>[]</code> (no labels).</li>
<li><code>tls</code> - used to create an HTTPS connection. The <code>tls</code> object is passed unchanged as options to
the node.js HTTPS server as described in the
<a href="http://nodejs.org/api/https.html#https_https_createserver_options_requestlistener" id="">node.js HTTPS documentation</a>.
Set to <code>true</code> when passing a <code>listener</code> object that has been configured to use TLS directly.</li>
<li>Any <a href="#server.config.connections" id="">connections configuration server defaults</a> can be included to
override and customize the individual connection.</li>
</ul>

<p>Returns a server object with the new connection selected.</p>

<p>Must be called before any other server method that modifies connections is called for it to apply
to the new connection (e.g. <a href="#serverstatename-options" id=""><code>server.state()</code></a>).</p>

<p>Note that the <code>options</code> object is deeply cloned (with the exception of <code>listener</code> which is
shallowly copied) and cannot contain any values that are unsafe to perform deep copy on.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();

<span class="pl-k">const</span> <span class="pl-c1">web</span> <span class="pl-k">=</span> server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">8000</span>, host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>example.com<span class="pl-pds">&apos;</span></span>, labels<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">&apos;</span>web<span class="pl-pds">&apos;</span></span>] });
<span class="pl-k">const</span> <span class="pl-c1">admin</span> <span class="pl-k">=</span> server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">8001</span>, host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>example.com<span class="pl-pds">&apos;</span></span>, labels<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">&apos;</span>admin<span class="pl-pds">&apos;</span></span>] });

<span class="pl-c">// server.connections.length === 2</span>
<span class="pl-c">// web.connections.length === 1</span>
<span class="pl-c">// admin.connections.length === 1</span></pre></div>

<p>Special care must be taken when adding connections inside a plugin <code>register()</code> method. Because
plugin connections selection happens before registration, any connection added inside the plugin
will not be included in the <code>server.connections</code> array. For this reason, the <code>server</code> object
provided to the <code>register()</code> method does not support the <code>connection()</code> method.</p>

<p>However, connectionless plugins (plugins with <code>attributes.connections</code> set to <code>false</code>) provide
a powerful bridge and allow plugins to add connections. This is done by using the <code>register()</code>
<code>server</code> argument only for adding the new connection using <code>server.connection()</code> and then
using the return value from the <code>connection()</code> method (which is another <code>server</code> with the new
connection selected) to perform any other actions that should include the new connection (only).</p>

<p>While this pattern can be accomplished without setting the plugin to connectionless mode, it
makes the code safer and easier to maintain because it will prevent trying to use the <code>server</code>
argument to manage the new connection and will throw an exception (instead of just failing
silently). Without setting the plugin to connectionless mode, you must use
<code>server.root.connection()</code> which will return a <code>server</code> object scoped for the root realm, not
the current plugin.</p>

<p>For example:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">srv</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    <span class="pl-c">// Use the &apos;srv&apos; argument to add a new connection</span>

    <span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> srv.connection();

    <span class="pl-c">// Use the &apos;server&apos; return value to manage the new connection</span>

    server.route({
        path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
        method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
        <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>hello<span class="pl-pds">&apos;</span></span>);
        }
    });

    <span class="pl-k">return</span> next();
};

<span class="pl-c1">exports</span>.register.<span class="pl-c1">attributes</span> <span class="pl-k">=</span> {
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>example<span class="pl-pds">&apos;</span></span>,
    connections<span class="pl-k">:</span> <span class="pl-c1">false</span>
};</pre></div>

<h3><a id="serverdecoratetype-property-method-options" class="anchor" href="#serverdecoratetype-property-method-options" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.decorate(type, property, method, [options])</code></h3>

<p>Extends various framework interfaces with custom methods where:</p>

<ul>
<li><code>type</code> - the interface being decorated. Supported types:

<ul>
<li><code>&apos;request&apos;</code> - adds methods to the <a href="#request-object" id="">Request object</a>.</li>
<li><code>&apos;reply&apos;</code> - adds methods to the <a href="#reply-interface" id="">reply interface</a>.</li>
<li><code>&apos;server&apos;</code> - adds methods to the <a href="#server" id="">Server</a> object.</li>
</ul></li>
<li><code>property</code> - the object decoration key name.</li>
<li><code>method</code> - the extension function or other value.</li>
<li><code>options</code> - if the <code>type</code> is <code>&apos;request&apos;</code>, supports the following optional settings:

<ul>
<li><code>apply</code> - if <code>true</code>, the <code>method</code> function is invoked using the signature <code>function(request)</code>
where <code>request</code> is the current request object and the returned value is assigned as the
decoration.</li>
</ul></li>
</ul>

<p>Note that decorations apply to the entire server and all its connections regardless of current
selection.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">success</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {

    <span class="pl-k">return</span> <span class="pl-v">this</span>.response({ status<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span> });
};

server.decorate(<span class="pl-s"><span class="pl-pds">&apos;</span>reply<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>success<span class="pl-pds">&apos;</span></span>, success);

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply.success();
    }
});</pre></div>

<h3><a id="serverdependencydependencies-after" class="anchor" href="#serverdependencydependencies-after" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.dependency(dependencies, [after])</code></h3>

<p>Used within a plugin to declares a required dependency on other <a href="#plugins" id="">plugins</a> where:</p>

<ul>
<li><code>dependencies</code> - a single string or array of plugin name strings which must be registered in
order for this plugin to operate. Plugins listed must be registered before the server is started.
Does not provide version dependency which should be implemented using
<a href="http://blog.nodejs.org/2013/02/07/peer-dependencies/" id="">npm peer dependencies</a>.</li>
<li><code>after</code> - an optional function called after all the specified dependencies have been registered
and before the server starts. The function is only called if the server is started. If a circular
dependency is detected, an exception is thrown (e.g. two plugins each has an <code>after</code> function
to be called after the other). The function signature is <code>function(server, next)</code> where:

<ul>
<li><code>server</code> - the server the <code>dependency()</code> method was called on.</li>
<li><code>next</code> - the callback function the method must call to return control over to the application
and complete the registration process. The function signature is <code>function(err)</code> where:

<ul>
<li><code>err</code> - internal error condition, which is returned back via the
<a href="#serverstartcallback" id=""><code>server.start()</code></a> callback.</li>
</ul></li>
</ul></li>
</ul>

<p>The <code>after</code> method is identical to setting a server extension point on <code>&apos;onPreStart&apos;</code>. Connectionless
plugins (those with <code>attributes.connections</code> set to <code>false</code>) can only depend on other connectionless
plugins (server initialization will fail even of the dependency is loaded but is not connectionless).</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">after</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">next</span>) {

    <span class="pl-c">// Additional plugin registration logic</span>
    <span class="pl-k">return</span> next();
};

<span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    server.dependency(<span class="pl-s"><span class="pl-pds">&apos;</span>yar<span class="pl-pds">&apos;</span></span>, after);
    <span class="pl-k">return</span> next();
};</pre></div>

<p>Dependencies can also be set via the register <code>attributes</code> property (does not support setting
<code>after</code>):</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    <span class="pl-k">return</span> next();
};

register.<span class="pl-c1">attributes</span> <span class="pl-k">=</span> {
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span>,
    version<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>1.0.0<span class="pl-pds">&apos;</span></span>,
    dependencies<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>yar<span class="pl-pds">&apos;</span></span>
};</pre></div>

<h3><a id="serverexposekey-value" class="anchor" href="#serverexposekey-value" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.expose(key, value)</code></h3>

<p>Used within a plugin to expose a property via <code>server.plugins[name]</code> where:</p>

<ul>
<li><code>key</code> - the key assigned (<code>server.plugins[name][key]</code>).</li>
<li><code>value</code> - the value assigned.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    server.expose(<span class="pl-s"><span class="pl-pds">&apos;</span>util<span class="pl-pds">&apos;</span></span>, <span class="pl-k">function</span> () { <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>something<span class="pl-pds">&apos;</span></span>); });
    <span class="pl-k">return</span> next();
};</pre></div>

<h3><a id="serverexposeobj" class="anchor" href="#serverexposeobj" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.expose(obj)</code></h3>

<p>Merges a deep copy of an object into to the existing content of <code>server.plugins[name]</code> where:</p>

<ul>
<li><code>obj</code> - the object merged into the exposed properties container.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    server.expose({ <span class="pl-en">util</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>something<span class="pl-pds">&apos;</span></span>); } });
    <span class="pl-k">return</span> next();
};</pre></div>

<h3><a id="serverextevents" class="anchor" href="#serverextevents" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.ext(events)</code></h3>

<p>Registers an extension function in one of the available extension points where:</p>

<ul>
<li><code>events</code> - an object or array of objects with the following:

<ul>
<li><code>type</code> - the extension point event name. The available extension points include the
<a href="#request-lifecycle" id="">request extension points</a> as well as the following server extension points:

<ul>
<li><code>&apos;onPreStart&apos;</code> - called before the connection listeners are started.</li>
<li><code>&apos;onPostStart&apos;</code> - called after the connection listeners are started.</li>
<li><code>&apos;onPreStop&apos;</code> - called before the connection listeners are stopped.</li>
<li><code>&apos;onPostStop&apos;</code> - called after the connection listeners are stopped.</li>
</ul></li>
<li><code>method</code> - a function or an array of functions to be executed at a specified point during request
processing. The required extension function signature is:

<ul>
<li>server extension points: <code>function(server, next)</code> where:

<ul>
<li><code>server</code> - the server object.</li>
<li><code>next</code> - the continuation method with signature <code>function(err)</code>.</li>
<li><code>this</code> - the object provided via <code>options.bind</code> or the current active context set with
<a href="#serverbindcontext" id=""><code>server.bind()</code></a>.</li>
</ul></li>
<li>request extension points: <code>function(request, reply)</code> where:

<ul>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>reply</code> - the <a href="#reply-interface" id="">reply interface</a> which is used to return control back to the
framework. To continue normal execution of the <a href="#request-lifecycle" id="">request lifecycle</a>,
<code>reply.continue()</code> must be called. To abort processing and return a response to the client,
call <code>reply(value)</code> where value is an error or any other valid response.</li>
<li><code>this</code> - the object provided via <code>options.bind</code> or the current active context set with
<a href="#serverbindcontext" id=""><code>server.bind()</code></a>.</li>
</ul></li>
</ul></li>
<li><code>options</code> - an optional object with the following:

<ul>
<li><code>before</code> - a string or array of strings of plugin names this method must execute before (on
the same event). Otherwise, extension methods are executed in the order added.</li>
<li><code>after</code> - a string or array of strings of plugin names this method must execute after (on the
same event). Otherwise, extension methods are executed in the order added.</li>
<li><code>bind</code> - a context object passed back to the provided method (via <code>this</code>) when called.
Ignored if the method is an arrow function.</li>
<li><code>sandbox</code> - if set to <code>&apos;plugin&apos;</code> when adding a <a href="#request-lifecycle" id="">request extension points</a>
the extension is only added to routes defined by the current plugin. Not allowed when
configuring route-level extensions, or when adding server extensions. Defaults to
<code>&apos;connection&apos;</code> which applies to any route added to the connection the extension is added
to.</li>
</ul></li>
</ul></li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.ext({
    type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>onRequest<span class="pl-pds">&apos;</span></span>,
    <span class="pl-en">method</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-c">// Change all requests to &apos;/test&apos;</span>
        request.setUrl(<span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>);
        <span class="pl-k">return</span> reply.continue();
    }
});

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply({ status<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span> });
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> handler });
server.<span class="pl-c1">start</span>((<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> { });

<span class="pl-c">// All requests will get routed to &apos;/test&apos;</span></pre></div>

<h3><a id="serverextevent-method-options" class="anchor" href="#serverextevent-method-options" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.ext(event, method, [options])</code></h3>

<p>Registers a single extension event using the same properties as used in
<a href="#serverextevents" id=""><code>server.ext(events)</code></a>, but passed as arguments.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onRequest<span class="pl-pds">&apos;</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-c">// Change all requests to &apos;/test&apos;</span>
    request.setUrl(<span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>);
    <span class="pl-k">return</span> reply.continue();
});

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply({ status<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span> });
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> handler });
server.<span class="pl-c1">start</span>((<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> { });

<span class="pl-c">// All requests will get routed to &apos;/test&apos;</span></pre></div>

<h3><a id="serverhandlername-method" class="anchor" href="#serverhandlername-method" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.handler(name, method)</code></h3>

<p>Registers a new handler type to be used in routes where:</p>

<ul>
<li><code>name</code> - string name for the handler being registered. Cannot override any previously registered
type.</li>
<li><code>method</code> - the function used to generate the route handler using the signature
<code>function(route, options)</code> where:

<ul>
<li><code>route</code> - the <a href="#route-public-interface" id="">route public interface</a> object.</li>
<li><code>options</code> - the configuration object provided in the handler config.</li>
</ul></li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>localhost<span class="pl-pds">&apos;</span></span>, port<span class="pl-k">:</span> <span class="pl-c1">8000</span> });

<span class="pl-c">// Defines new handler for routes on this server</span>
<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">route</span>, <span class="pl-smi">options</span>) {

    <span class="pl-k">return</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>new handler: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> options.msg);
    }
};

server.handler(<span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span>, handler);

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    handler<span class="pl-k">:</span> { test<span class="pl-k">:</span> { msg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span> } }
});

server.<span class="pl-c1">start</span>(<span class="pl-k">function</span> (<span class="pl-smi">err</span>) { });</pre></div>

<p>The <code>method</code> function can have a <code>defaults</code> object or function property. If the property is set to
an object, that object is used as the default route config for routes using this handler. If the
property is set to a function, the function uses the signature <code>function(method)</code> and returns the
route default configuration.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>localhost<span class="pl-pds">&apos;</span></span>, port<span class="pl-k">:</span> <span class="pl-c1">8000</span> });

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">route</span>, <span class="pl-smi">options</span>) {

    <span class="pl-k">return</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>new handler: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> options.msg);
    }
};

<span class="pl-c">// Change the default payload processing for this handler</span>
handler.defaults <span class="pl-k">=</span> {
    payload<span class="pl-k">:</span> {
        output<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>stream<span class="pl-pds">&apos;</span></span>,
        parse<span class="pl-k">:</span> <span class="pl-c1">false</span>
    }
};

server.handler(<span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span>, handler);</pre></div>

<h3><a id="serverinitializecallback" class="anchor" href="#serverinitializecallback" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.initialize(callback)</code></h3>

<p>Initializes the server (starts the caches, finalizes plugin registration) but does not start listening
on the connection ports, where:</p>

<ul>
<li><code>callback</code> - the callback method when server initialization is completed or failed with the signature
<code>function(err)</code> where:

<ul>
<li><code>err</code> - any initialization error condition.</li>
</ul></li>
</ul>

<p>Note that if the method fails and the callback includes an error, the server is considered to be in
an undefined state and should be shut down. In most cases it would be impossible to fully recover as
the various plugins, caches, and other event listeners will get confused by repeated attempts to
start the server or make assumptions about the healthy state of the environment. It is recommended
to assert that no error has been returned after calling <code>initialize()</code> to abort the process when the
server fails to start properly. If you must try to resume after an error, call <code>server.stop()</code>
first to reset the server state.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">Hoek</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hoek<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.initialize((<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {

    Hoek.<span class="pl-c1">assert</span>(<span class="pl-k">!</span>err, err);
});</pre></div>

<h3><a id="serverinjectoptions-callback" class="anchor" href="#serverinjectoptions-callback" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.inject(options, callback)</code></h3>

<p>When the server contains exactly one connection, injects a request into the sole connection
simulating an incoming HTTP request without making an actual socket connection. Injection is useful
for testing purposes as well as for invoking routing logic internally without the overhead or
limitations of the network stack. Utilizes the <a href="https://github.com/hapijs/shot" id=""><strong>shot</strong></a> module
for performing injections, with some additional options and response properties:</p>

<ul>
<li><code>options</code> - can be assign a string with the requested URI, or an object with:

<ul>
<li><code>method</code> - the request HTTP method (e.g. <code>&apos;POST&apos;</code>). Defaults to <code>&apos;GET&apos;</code>.</li>
<li><code>url</code> - the request URL. If the URI includes an authority (e.g. <code>&apos;example.com:8080&apos;</code>), it is
used to automatically set an HTTP &apos;Host&apos; header, unless one was specified in <code>headers</code>.</li>
<li><code>headers</code> - an object with optional request headers where each key is the header name and the
value is the header content. Defaults to no additions to the default Shot headers.</li>
<li><code>payload</code> - an optional string, buffer or object containing the request payload. In case of an object it will be converted to a string for you. Defaults to no payload. Note that payload processing
defaults to <code>&apos;application/json&apos;</code> if no &apos;Content-Type&apos; header provided.</li>
<li><code>credentials</code> - an optional credentials object containing authentication information. The
<code>credentials</code> are used to bypass the default authentication strategies, and are validated
directly as if they were received via an authentication scheme. Defaults to no credentials.</li>
<li><code>artifacts</code> - an optional artifacts object containing authentication artifact information. The
<code>artifacts</code> are used to bypass the default authentication strategies, and are validated
directly as if they were received via an authentication scheme. Ignored if set without
<code>credentials</code>. Defaults to no artifacts.</li>
<li><code>app</code> - sets the initial value of <code>request.app</code>.</li>
<li><code>plugins</code> - sets the initial value of <code>request.plugins</code>.</li>
<li><code>allowInternals</code> - allows access to routes with <code>config.isInternal</code> set to <code>true</code>. Defaults to
<code>false</code>.</li>
<li><code>remoteAddress</code> - sets the remote address for the incoming connection.</li>
<li><code>simulate</code> - an object with options used to simulate client request stream conditions for
testing:

<ul>
<li><code>error</code> - if <code>true</code>, emits an <code>&apos;error&apos;</code> event after payload transmission (if any).
Defaults to <code>false</code>.</li>
<li><code>close</code> - if <code>true</code>, emits a <code>&apos;close&apos;</code> event after payload transmission (if any).
Defaults to <code>false</code>.</li>
<li><code>end</code> - if <code>false</code>, does not end the stream. Defaults to <code>true</code>.</li>
</ul></li>
</ul></li>
<li><code>callback</code> - the callback function with signature <code>function(res)</code> where:

<ul>
<li><code>res</code> - the response object where:

<ul>
<li><code>statusCode</code> - the HTTP status code.</li>
<li><code>headers</code> - an object containing the headers set.</li>
<li><code>payload</code> - the response payload string.</li>
<li><code>rawPayload</code> - the raw response payload buffer.</li>
<li><code>raw</code> - an object with the injection request and response objects:

<ul>
<li><code>req</code> - the simulated node request object.</li>
<li><code>res</code> - the simulated node response object.</li>
</ul></li>
<li><code>result</code> - the raw handler response (e.g. when not a stream or a view) before it is
serialized for transmission. If not available, the value is set to <code>payload</code>. Useful for
inspection and reuse of the internal objects returned (instead of parsing the response
string).</li>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
</ul></li>
</ul></li>
</ul>

<p>When the server contains more than one connection, each <a href="#serverconnections" id=""><code>server.connections</code></a>
array member provides its own <code>connection.inject()</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>Success!<span class="pl-pds">&apos;</span></span>);
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> handler });

server.inject(<span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">res</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(res.result);
});</pre></div>

<h3><a id="serverlogtags-data-timestamp" class="anchor" href="#serverlogtags-data-timestamp" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.log(tags, [data, [timestamp]])</code></h3>

<p>Logs server events that cannot be associated with a specific request. When called the server emits
a <code>&apos;log&apos;</code> event which can be used by other listeners or <a href="#plugins" id="">plugins</a> to record the
information or output to the console. The arguments are:</p>

<ul>
<li><code>tags</code> - a string or an array of strings (e.g. <code>[&apos;error&apos;, &apos;database&apos;, &apos;read&apos;]</code>) used to identify
the event. Tags are used instead of log levels and provide a much more expressive mechanism for
describing and filtering events. Any logs generated by the server internally include the <code>&apos;hapi&apos;</code>
tag along with event-specific information.</li>
<li><code>data</code> - an optional message string or object with the application data being logged.</li>
<li><code>timestamp</code> - an optional timestamp expressed in milliseconds. Defaults to <code>Date.now()</code> (now).</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>log<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">event</span>, <span class="pl-smi">tags</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-k">if</span> (tags.error) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">event</span>);
    }
});

server.<span class="pl-c1">log</span>([<span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>error<span class="pl-pds">&apos;</span></span>], <span class="pl-s"><span class="pl-pds">&apos;</span>Test event<span class="pl-pds">&apos;</span></span>);</pre></div>

<h3><a id="serverlookupid" class="anchor" href="#serverlookupid" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.lookup(id)</code></h3>

<p>When the server contains exactly one connection, looks up a route configuration where:</p>

<ul>
<li><code>id</code> - the route identifier as set in the <a href="#route-options" id="">route options</a>.</li>
</ul>

<p>returns the <a href="#route-public-interface" id="">route public interface</a> object if found, otherwise <code>null</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection();
server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    config<span class="pl-k">:</span> {
        <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">return</span> reply();
        },
        id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>root<span class="pl-pds">&apos;</span></span>
    }
});

<span class="pl-k">const</span> <span class="pl-c1">route</span> <span class="pl-k">=</span> server.lookup(<span class="pl-s"><span class="pl-pds">&apos;</span>root<span class="pl-pds">&apos;</span></span>);</pre></div>

<p>When the server contains more than one connection, each <a href="#serverconnections" id=""><code>server.connections</code></a>
array member provides its own <code>connection.lookup()</code> method.</p>

<h3><a id="servermatchmethod-path-host" class="anchor" href="#servermatchmethod-path-host" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.match(method, path, [host])</code></h3>

<p>When the server contains exactly one connection, looks up a route configuration where:</p>

<ul>
<li><code>method</code> - the HTTP method (e.g. &apos;GET&apos;, &apos;POST&apos;).</li>
<li><code>path</code> - the requested path (must begin with &apos;/&apos;).</li>
<li><code>host</code> - optional hostname (to match against routes with <code>vhost</code>).</li>
</ul>

<p>returns the <a href="#route-public-interface" id="">route public interface</a> object if found, otherwise <code>null</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection();
server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    config<span class="pl-k">:</span> {
        <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">return</span> reply();
        },
        id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>root<span class="pl-pds">&apos;</span></span>
    }
});

<span class="pl-k">const</span> <span class="pl-c1">route</span> <span class="pl-k">=</span> server.<span class="pl-c1">match</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>get<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>);</pre></div>

<p>When the server contains more than one connection, each <a href="#serverconnections" id=""><code>server.connections</code></a>
array member provides its own <code>connection.match()</code> method.</p>

<h3><a id="servermethodname-method-options" class="anchor" href="#servermethodname-method-options" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.method(name, method, [options])</code></h3>

<p>Registers a server method. Server methods are functions registered with the server and used
throughout the application as a common utility. Their advantage is in the ability to configure them
to use the built-in cache and share across multiple request handlers without having to create a
common module.</p>

<p>Methods are registered via <code>server.method(name, method, [options])</code> where:</p>

<ul>
<li><code>name</code> - a unique method name used to invoke the method via <code>server.methods[name]</code>.
Supports using nested names such as <code>utils.users.get</code> which will automatically
create the missing path under <a href="#servermethods" id=""><code>server.methods</code></a> and can be accessed
for the previous example via <code>server.methods.utils.users.get</code>.
When configured with caching enabled, <code>server.methods[name].cache</code> will be an object
with the following properties and methods:

<ul>
<li><code>drop(arg1, arg2, ..., argn, callback)</code> - function that can be used to clear the cache for a given key.</li>
<li><code>stats</code> - an object with cache statistics, see stats documentation for <strong>catbox</strong>.</li>
</ul></li>
<li><code>method</code> - the method function with the signature is one of:

<ul>
<li><code>function(arg1, arg2, ..., argn, next)</code> where:

<ul>
<li><code>arg1</code>, <code>arg2</code>, etc. - the method function arguments.</li>
<li><code>next</code> - the function called when the method is done with the signature
<code>function(err, result, ttl)</code> where:

<ul>
<li><code>err</code> - error response if the method failed.</li>
<li><code>result</code> - the return value.</li>
<li><code>ttl</code> - <code>0</code> if result is valid but cannot be cached. Defaults to cache policy.</li>
</ul></li>
</ul></li>
<li><code>function(arg1, arg2, ..., argn)</code> where:

<ul>
<li><code>arg1</code>, <code>arg2</code>, etc. - the method function arguments.</li>
<li>the <code>callback</code> option is set to <code>false</code>.</li>
<li>the method must returns a value (result, <code>Error</code>, or a promise) or throw an <code>Error</code>.</li>
</ul></li>
</ul></li>
<li><code>options</code> - optional configuration:

<ul>
<li><code>bind</code> - a context object passed back to the method function (via <code>this</code>) when called.
Defaults to active context (set via <a href="#serverbindcontext" id=""><code>server.bind()</code></a> when the method is
registered. Ignored if the method is an arrow function.</li>
<li><code>cache</code> - the same cache configuration used in <a href="#servercacheoptions" id=""><code>server.cache()</code></a>. The
<code>generateTimeout</code> option is required.</li>
<li><code>callback</code> - if <code>false</code>, expects the <code>method</code> to be a synchronous function. Note that using a
synchronous function with caching will convert the method interface to require a callback as
an additional argument with the signature <code>function(err, result, cached, report)</code> since the
cache interface cannot return values synchronously. Defaults to <code>true</code>.</li>
<li><code>generateKey</code> - a function used to generate a unique key (for caching) from the arguments
passed to the method function (the callback argument is not passed as input). The server
will automatically generate a unique key if the function&apos;s arguments are all of types
<code>&apos;string&apos;</code>, <code>&apos;number&apos;</code>, or <code>&apos;boolean&apos;</code>. However if the method uses other types of arguments,
a key generation function must be provided which takes the same arguments as the function and
returns a unique string (or <code>null</code> if no key can be generated).</li>
</ul></li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-c">// Simple arguments</span>

<span class="pl-k">const</span> <span class="pl-c1">add</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">a</span>, <span class="pl-smi">b</span>, <span class="pl-smi">next</span>) {

    <span class="pl-k">return</span> next(<span class="pl-c1">null</span>, a <span class="pl-k">+</span> b);
};

server.<span class="pl-c1">method</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>sum<span class="pl-pds">&apos;</span></span>, add, { cache<span class="pl-k">:</span> { expiresIn<span class="pl-k">:</span> <span class="pl-c1">2000</span> } });

server.methods.sum(<span class="pl-c1">4</span>, <span class="pl-c1">5</span>, (<span class="pl-smi">err</span>, <span class="pl-smi">result</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(result);
});

<span class="pl-c">// Object argument</span>

<span class="pl-k">const</span> <span class="pl-c1">addArray</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">array</span>, <span class="pl-smi">next</span>) {

    <span class="pl-k">let</span> sum <span class="pl-k">=</span> <span class="pl-c1">0</span>;
    array.forEach((<span class="pl-smi">item</span>)<span class="pl-k"> =&gt;</span> {

        sum <span class="pl-k">+=</span> item;
    });

    <span class="pl-k">return</span> next(<span class="pl-c1">null</span>, sum);
};

server.<span class="pl-c1">method</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>sumObj<span class="pl-pds">&apos;</span></span>, addArray, {
    cache<span class="pl-k">:</span> { expiresIn<span class="pl-k">:</span> <span class="pl-c1">2000</span> },
    <span class="pl-en">generateKey</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">array</span>) {

        <span class="pl-k">return</span> array.<span class="pl-c1">join</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>,<span class="pl-pds">&apos;</span></span>);
    }
});

server.methods.sumObj([<span class="pl-c1">5</span>, <span class="pl-c1">6</span>], (<span class="pl-smi">err</span>, <span class="pl-smi">result</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(result);
});

<span class="pl-c">// Synchronous method with cache</span>

<span class="pl-k">const</span> <span class="pl-c1">addSync</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) {

    <span class="pl-k">return</span> a <span class="pl-k">+</span> b;
};

server.<span class="pl-c1">method</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>sumSync<span class="pl-pds">&apos;</span></span>, addSync, { cache<span class="pl-k">:</span> { expiresIn<span class="pl-k">:</span> <span class="pl-c1">2000</span> }, callback<span class="pl-k">:</span> <span class="pl-c1">false</span> });

server.methods.sumSync(<span class="pl-c1">4</span>, <span class="pl-c1">5</span>, (<span class="pl-smi">err</span>, <span class="pl-smi">result</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(result);
});</pre></div>

<h3><a id="servermethodmethods" class="anchor" href="#servermethodmethods" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.method(methods)</code></h3>

<p>Registers a server method function as described in
<a href="#servermethodname-method-options" id=""><code>server.method()</code></a> using a configuration object
where:</p>

<ul>
<li><code>methods</code> - an object or an array of objects where each one contains:

<ul>
<li><code>name</code> - the method name.</li>
<li><code>method</code> - the method function.</li>
<li><code>options</code> - optional settings.</li>
</ul></li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">add</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">a</span>, <span class="pl-smi">b</span>, <span class="pl-smi">next</span>) {

    next(<span class="pl-c1">null</span>, a <span class="pl-k">+</span> b);
};

server.<span class="pl-c1">method</span>({
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>sum<span class="pl-pds">&apos;</span></span>,
    method<span class="pl-k">:</span> add,
    options<span class="pl-k">:</span> {
        cache<span class="pl-k">:</span> {
            expiresIn<span class="pl-k">:</span> <span class="pl-c1">2000</span>
        }
    }
});</pre></div>

<h3><a id="serverpathrelativeto" class="anchor" href="#serverpathrelativeto" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.path(relativeTo)</code></h3>

<p>Sets the path prefix used to locate static resources (files and view templates) when relative paths
are used where:</p>

<ul>
<li><code>relativeTo</code> - the path prefix added to any relative file path starting with <code>&apos;.&apos;</code>.</li>
</ul>

<p>Note that setting a path within a plugin only applies to resources accessed by plugin methods.
If no path is set, the connection <code>files.relativeTo</code> configuration is used. The path only applies
to routes added after it has been set.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">exports</span>.<span class="pl-en">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    <span class="pl-c">// Assuming the Inert plugin was registered previously</span>

    server.path(<span class="pl-c1">__dirname</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&apos;</span>../static<span class="pl-pds">&apos;</span></span>);
    server.route({ path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/file<span class="pl-pds">&apos;</span></span>, method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> { file<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>./test.html<span class="pl-pds">&apos;</span></span> } });
    next();
};</pre></div>

<h3><a id="serverregisterplugins-options-callback" class="anchor" href="#serverregisterplugins-options-callback" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.register(plugins, [options], callback)</code></h3>

<p>Registers a plugin where:</p>

<ul>
<li><code>plugins</code> - an object or array of objects where each one is either:

<ul>
<li>a plugin registration function.</li>
<li>an object with the following:

<ul>
<li><code>register</code> - the plugin registration function.</li>
<li><code>options</code> - optional options passed to the registration function when called.</li>
<li><code>once</code>, <code>select</code>, <code>routes</code> - optional plugin-specific registration options as defined below.</li>
</ul></li>
</ul></li>
<li><code>options</code> - optional registration options (different from the options passed to the registration
function):

<ul>
<li><code>once</code> - if <code>true</code>, the registration is skipped for any connection already registered with.
Cannot be used with plugin options. If the plugin does not have a <code>connections</code> attribute set
to <code>false</code> and the registration selection is empty, registration will be skipped as no connections
are available to register once. Defaults to <code>false</code>.</li>
<li><code>routes</code> - modifiers applied to each route added by the plugin:

<ul>
<li><code>prefix</code> - string added as prefix to any route path (must begin with <code>&apos;/&apos;</code>). If a plugin
registers a child plugin the <code>prefix</code> is passed on to the child or is added in front of
the child-specific prefix.</li>
<li><code>vhost</code> - virtual host string (or array of strings) applied to every route. The
outer-most <code>vhost</code> overrides the any nested configuration.</li>
</ul></li>
<li><code>select</code> - a string or array of string labels used to pre-select connections for plugin
registration.</li>
</ul></li>
<li><code>callback</code> - the callback function with signature <code>function(err)</code> where:

<ul>
<li><code>err</code> - an error returned from the registration function. Note that exceptions thrown by the
registration function are not handled by the framework.</li>
</ul></li>
</ul>

<p>Note that plugin registration are recorded on each of the available connections. When plugins
express a dependency on other plugins, both have to be loaded into the same connections for the
dependency requirement to be fulfilled. It is recommended that plugin registration happen after
all the server connections are created via <code>server.connection()</code>.</p>

<div class="highlight highlight-source-js"><pre>server.register({
    register<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>plugin_name<span class="pl-pds">&apos;</span></span>),
    options<span class="pl-k">:</span> {
        message<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>hello<span class="pl-pds">&apos;</span></span>
    }
 }, (<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {

     <span class="pl-k">if</span> (err) {
         <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Failed loading plugin<span class="pl-pds">&apos;</span></span>);
     }
 });</pre></div>

<h3><a id="serverrouteoptions" class="anchor" href="#serverrouteoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.route(options)</code></h3>

<p>Adds a connection route where:</p>

<ul>
<li><code>options</code> - a <a href="#route-configuration" id="">route configuration object</a> or an array of configuration
objects.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>, <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) { <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span>); } });
server.route([
    { method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/1<span class="pl-pds">&apos;</span></span>, <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) { <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span>); } },
    { method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/2<span class="pl-pds">&apos;</span></span>, <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) { <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span>); } }
]);</pre></div>

<h3><a id="serverselectlabels" class="anchor" href="#serverselectlabels" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.select(labels)</code></h3>

<p>Selects a subset of the server&apos;s connections where:</p>

<ul>
<li><code>labels</code> - a single string or array of strings of labels used as a logical OR statement to select
all the connections with matching labels in their configuration.</li>
</ul>

<p>Returns a server object with <code>connections</code> set to the requested subset. Selecting again on a
selection operates as a logic AND statement between the individual selections.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span>, labels<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">&apos;</span>a<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>b<span class="pl-pds">&apos;</span></span>] });
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">8080</span>, labels<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">&apos;</span>a<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>c<span class="pl-pds">&apos;</span></span>] });
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">8081</span>, labels<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">&apos;</span>b<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>c<span class="pl-pds">&apos;</span></span>] });

<span class="pl-k">const</span> <span class="pl-c1">a</span> <span class="pl-k">=</span> server.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>a<span class="pl-pds">&apos;</span></span>);     <span class="pl-c">// 80, 8080</span>
<span class="pl-k">const</span> <span class="pl-c1">ac</span> <span class="pl-k">=</span> a.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>c<span class="pl-pds">&apos;</span></span>);         <span class="pl-c">// 8080</span></pre></div>

<h3><a id="serverstartcallback" class="anchor" href="#serverstartcallback" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.start(callback)</code></h3>

<p>Starts the server connections by listening for incoming requests on the configured port of each
listener (unless the connection was configured with <code>autoListen</code> set to <code>false</code>), where:</p>

<ul>
<li><code>callback</code> - the callback method when server startup is completed or failed with the signature
<code>function(err)</code> where:

<ul>
<li><code>err</code> - any startup error condition.</li>
</ul></li>
</ul>

<p>Note that if the method fails and the callback includes an error, the server is considered to be in
an undefined state and should be shut down. In most cases it would be impossible to fully recover as
the various plugins, caches, and other event listeners will get confused by repeated attempts to
start the server or make assumptions about the healthy state of the environment. It is recommended
to assert that no error has been returned after calling <code>start()</code> to abort the process when the
server fails to start properly. If you must try to resume after a start error, call <code>server.stop()</code>
first to reset the server state.</p>

<p>If a started server is started again, the second call to <code>start()</code> will only start new connections
add after the initial <code>start()</code> was called. No events will be emitted and no extension points
invoked.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">Hoek</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hoek<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.<span class="pl-c1">start</span>((<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {

    Hoek.<span class="pl-c1">assert</span>(<span class="pl-k">!</span>err, err);
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Server started at: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> server.info.uri);
});</pre></div>

<h3><a id="serverstatename-options" class="anchor" href="#serverstatename-options" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.state(name, [options])</code></h3>

<p><a href="http://tools.ietf.org/html/rfc6265" id="">HTTP state management</a> uses client cookies to persist a state
across multiple requests. Registers a cookie definitions where:</p>

<ul>
<li><code>name</code> - the cookie name string.</li>
<li><code>options</code> - are the optional cookie settings:

<ul>
<li><code>ttl</code> - time-to-live in milliseconds. Defaults to <code>null</code> (session time-life - cookies are
deleted when the browser is closed).</li>
<li><code>isSecure</code> - sets the &apos;Secure&apos; flag. Defaults to <code>false</code>.</li>
<li><code>isHttpOnly</code> - sets the &apos;HttpOnly&apos; flag. Defaults to <code>false</code>.</li>
<li><code>path</code> - the path scope. Defaults to <code>null</code> (no path).</li>
<li><code>domain</code> - the domain scope. Defaults to <code>null</code> (no domain).</li>
<li><code>autoValue</code> - if present and the cookie was not received from the client or explicitly set by
the route handler, the cookie is automatically added to the response with the provided value.
The value can be a function with signature <code>function(request, next)</code> where:

<ul>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>next</code> - the continuation function using the <code>function(err, value)</code> signature.</li>
</ul></li>
<li><code>encoding</code> - encoding performs on the provided value before serialization. Options are:

<ul>
<li><code>&apos;none&apos;</code> - no encoding. When used, the cookie value must be a string. This is the default
value.</li>
<li><code>&apos;base64&apos;</code> - string value is encoded using Base64.</li>
<li><code>&apos;base64json&apos;</code> - object value is JSON-stringified than encoded using Base64.</li>
<li><code>&apos;form&apos;</code> - object value is encoded using the <em>x-www-form-urlencoded</em> method.</li>
<li><code>&apos;iron&apos;</code> - Encrypts and sign the value using
<a href="https://github.com/hueniverse/iron" id=""><strong>iron</strong></a>.</li>
</ul></li>
<li><code>sign</code> - an object used to calculate an HMAC for cookie integrity validation. This does not
provide privacy, only a mean to verify that the cookie value was generated by the server.
Redundant when <code>&apos;iron&apos;</code> encoding is used. Options are:

<ul>
<li><code>integrity</code> - algorithm options. Defaults to
<a href="https://github.com/hueniverse/iron#options" id=""><code>require(&apos;iron&apos;).defaults.integrity</code></a>.</li>
<li><code>password</code> - password used for HMAC key generation.</li>
</ul></li>
<li><code>password</code> - password used for <code>&apos;iron&apos;</code> encoding.</li>
<li><code>iron</code> - options for <code>&apos;iron&apos;</code> encoding. Defaults to
<a href="https://github.com/hueniverse/iron#options" id=""><code>require(&apos;iron&apos;).defaults</code></a>.</li>
<li><code>ignoreErrors</code> - if <code>false</code>, errors are ignored and treated as missing cookies.</li>
<li><code>clearInvalid</code> - if <code>true</code>, automatically instruct the client to remove invalid
cookies. Defaults to <code>false</code>.</li>
<li><code>strictHeader</code> - if <code>false</code>, allows any cookie value including values in
violation of <a href="https://tools.ietf.org/html/rfc6265" id="">RFC 6265</a>. Defaults to <code>true</code>.</li>
<li><code>passThrough</code> - overrides the default proxy <code>localStatePassThrough</code> setting.</li>
</ul></li>
</ul>

<p>State defaults can be modified via the server <code>connections.routes.state</code> configuration option.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-c">// Set cookie definition</span>

server.state(<span class="pl-s"><span class="pl-pds">&apos;</span>session<span class="pl-pds">&apos;</span></span>, {
    ttl<span class="pl-k">:</span> <span class="pl-c1">24</span> <span class="pl-k">*</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">1000</span>,     <span class="pl-c">// One day</span>
    isSecure<span class="pl-k">:</span> <span class="pl-c1">true</span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    encoding<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>base64json<span class="pl-pds">&apos;</span></span>
});

<span class="pl-c">// Set state in route handler</span>

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">let</span> session <span class="pl-k">=</span> request.state.session;
    <span class="pl-k">if</span> (<span class="pl-k">!</span>session) {
        session <span class="pl-k">=</span> { user<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>joe<span class="pl-pds">&apos;</span></span> };
    }

    session.last <span class="pl-k">=</span> <span class="pl-c1">Date</span>.now();

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>Success<span class="pl-pds">&apos;</span></span>).state(<span class="pl-s"><span class="pl-pds">&apos;</span>session<span class="pl-pds">&apos;</span></span>, session);
};</pre></div>

<p>Registered cookies are automatically parsed when received. Parsing rules depends on the route
<a href="#route.config.state" id=""><code>state.parse</code></a> configuration. If an incoming registered cookie fails parsing,
it is not included in <code>request.state</code>, regardless of the <code>state.failAction</code> setting. When
<code>state.failAction</code> is set to <code>&apos;log&apos;</code> and an invalid cookie value is received, the server will emit
a <code>&apos;request-internal&apos;</code> event. To capture these errors subscribe to the <code>&apos;request-internal&apos;</code> events
and filter on <code>&apos;error&apos;</code> and <code>&apos;state&apos;</code> tags:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>request-internal<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">request</span>, <span class="pl-smi">event</span>, <span class="pl-smi">tags</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-k">if</span> (tags.error <span class="pl-k">&amp;&amp;</span> tags.state) {
        <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-c1">event</span>);
    }
});</pre></div>

<h3><a id="serverstopoptions-callback" class="anchor" href="#serverstopoptions-callback" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.stop([options], callback)</code></h3>

<p>Stops the server&apos;s connections by refusing to accept any new connections or requests (existing
connections will continue until closed or timeout), where:</p>

<ul>
<li><code>options</code> - optional object with:

<ul>
<li><code>timeout</code> - overrides the timeout in millisecond before forcefully terminating a connection.
Defaults to <code>5000</code> (5 seconds).</li>
</ul></li>
<li><code>callback</code> - optional callback method with signature <code>function()</code> which is called once all the
connections have ended and it is safe to exit the process.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.<span class="pl-c1">stop</span>({ timeout<span class="pl-k">:</span> <span class="pl-c1">60</span> <span class="pl-k">*</span> <span class="pl-c1">1000</span> }, (<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Server stopped<span class="pl-pds">&apos;</span></span>);
});</pre></div>

<h3><a id="servertablehost" class="anchor" href="#servertablehost" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>server.table([host])</code></h3>

<p>Returns a copy of the routing table where:</p>

<ul>
<li><code>host</code> - optional host to filter routes matching a specific virtual host. Defaults to all virtual
hosts.</li>
</ul>

<p>The return value is an array where each item is an object containing:</p>

<ul>
<li><code>info</code> - the <code>connection.info</code> the connection the table was generated for.</li>
<li><code>labels</code> - the connection labels.</li>
<li><code>table</code> - an array of routes where each route contains:

<ul>
<li><code>settings</code> - the route config with defaults applied.</li>
<li><code>method</code> - the HTTP method in lower case.</li>
<li><code>path</code> - the route path.</li>
</ul></li>
</ul>

<p>Note that if the server has not been started and multiple connections use port <code>0</code>, the table items
will override each other and will produce an incomplete result.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span>, host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>example.com<span class="pl-pds">&apos;</span></span> });
server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/example<span class="pl-pds">&apos;</span></span>, <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) { <span class="pl-k">return</span> reply(); } });

<span class="pl-k">const</span> <span class="pl-c1">table</span> <span class="pl-k">=</span> server.table();</pre></div>

<p>When calling <code>connection.table()</code> directly on each connection, the return value is the same as the
array <code>table</code> item value of an individual connection:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span>, host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>example.com<span class="pl-pds">&apos;</span></span> });
server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/example<span class="pl-pds">&apos;</span></span>, <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) { <span class="pl-k">return</span> reply(); } });

<span class="pl-k">const</span> <span class="pl-c1">table</span> <span class="pl-k">=</span> server.connections[<span class="pl-c1">0</span>].table();

<span class="pl-c">/*</span>
<span class="pl-c">    [</span>
<span class="pl-c">        {</span>
<span class="pl-c">            method: &apos;get&apos;,</span>
<span class="pl-c">            path: &apos;/example&apos;,</span>
<span class="pl-c">            settings: { ... }</span>
<span class="pl-c">        }</span>
<span class="pl-c">    ]</span>
<span class="pl-c">*/</span></pre></div>

<h3><a id="server-events" class="anchor" href="#server-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server events</h3>

<p>The server object inherits from <code>Events.EventEmitter</code> and emits the following events:</p>

<ul>
<li><code>&apos;log&apos;</code> - events logged with <a href="#serverlogtags-data-timestamp" id=""><code>server.log()</code></a> and
<a href="#server-logs" id="">server events</a> generated internally by the framework.</li>
<li><code>&apos;start&apos;</code> - emitted when the server is started using <a href="#serverstartcallback" id=""><code>server.start()</code></a>.</li>
<li><code>&apos;stop&apos;</code> - emitted when the server is stopped using <a href="#serverstopoptions-callback" id=""><code>server.stop()</code></a>.</li>
<li><code>&apos;request&apos;</code> - events generated by <a href="#requestlogtags-data-timestamp" id=""><code>request.log()</code></a>. Does not
include any internally generated events.</li>
<li><code>&apos;request-internal&apos;</code> - <a href="#request-logs" id="">request events</a> generated internally by the framework
(multiple events per request).</li>
<li><code>&apos;request-error&apos;</code> - emitted whenever an Internal Server Error (500) error response is sent.
Note that this event is emitted only if the error response is sent to the client. If the error
is replaced with a different response before it is sent to the client, no event is emitted.
Single event per request.</li>
<li><code>&apos;response&apos;</code> - emitted after the response is sent back to the client (or when the client
connection closed and no response sent, in which case <code>request.response</code> is <code>null</code>). Single event
per request.</li>
<li><code>&apos;tail&apos;</code> - emitted when a request finished processing, including any registered tails. Single
event per request.</li>
<li><code>&apos;route&apos;</code> - emitted when a route is added to a connection. Note that if a route is added to
multiple connections at the same time, each will emit a separate event. Note that the <code>route</code>
object must not be modified.</li>
</ul>

<p>Note that the server object should not be used to emit application events as its internal
implementation is designed to fan events out to the various plugin selections and not for
application events.</p>

<p>When provided (as listed below) the <code>event</code> object includes:</p>

<ul>
<li><code>timestamp</code> - the event timestamp.</li>
<li><code>request</code> - if the event relates to a request, the <code>request id</code>.</li>
<li><code>server</code> - if the event relates to a server, the <code>server.info.uri</code>.</li>
<li><code>tags</code> - an array of tags (e.g. <code>[&apos;error&apos;, &apos;http&apos;]</code>).</li>
<li><code>data</code> - optional event-specific information.</li>
<li><code>internal</code> -  <code>true</code> if the event was generated internally by the framework.</li>
</ul>

<p>The <code>&apos;log&apos;</code> event includes the <code>event</code> object and a <code>tags</code> object (where each tag is a key with the
value <code>true</code>):</p>

<div class="highlight highlight-source-js"><pre>server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>log<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">event</span>, <span class="pl-smi">tags</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-k">if</span> (tags.error) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Server error: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> (<span class="pl-c1">event</span>.<span class="pl-c1">data</span> <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">&apos;</span>unspecified<span class="pl-pds">&apos;</span></span>));
    }
});</pre></div>

<p>The <code>&apos;request&apos;</code> and <code>&apos;request-internal&apos;</code> events include the <a href="#request-object" id="">request object</a>, the
<code>event</code> object, and a <code>tags</code> object (where each tag is a key with the value <code>true</code>):</p>

<div class="highlight highlight-source-js"><pre>server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>request<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">request</span>, <span class="pl-smi">event</span>, <span class="pl-smi">tags</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-k">if</span> (tags.received) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>New request: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> request.<span class="pl-c1">id</span>);
    }
});</pre></div>

<p>The <code>&apos;request-error&apos;</code> event includes the <a href="#request-object" id="">request object</a> and the causing error
<code>err</code> object:</p>

<div class="highlight highlight-source-js"><pre>server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>request-error<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">request</span>, <span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Error response (500) sent for request: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> request.<span class="pl-c1">id</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&apos;</span> because: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> err.message);
});</pre></div>

<p>The <code>&apos;response&apos;</code> and <code>&apos;tail&apos;</code> events include the <a href="#request-object" id="">request object</a>:</p>

<div class="highlight highlight-source-js"><pre>server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>response<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">request</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Response sent for request: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> request.<span class="pl-c1">id</span>);
});</pre></div>

<p>The <code>&apos;route&apos;</code> event includes the <a href="#route-public-interface" id="">route public interface</a>, the connection,
and the server object used to add the route (e.g. the result of a plugin select operation):</p>

<div class="highlight highlight-source-js"><pre>server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>route<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">route</span>, <span class="pl-smi">connection</span>, <span class="pl-smi">server</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>New route added: <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> route.path);
});</pre></div>

<h4><a id="internal-events" class="anchor" href="#internal-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Internal events</h4>

<p>The following logs are generated automatically by the framework. Each event can be identified by
the combination of tags used.</p>

<h5><a id="request-logs" class="anchor" href="#request-logs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request logs</h5>

<p>Emitted by the server <code>&apos;request-internal&apos;</code> event:</p>

<ul>
<li><code>received</code> - a new request received. Includes information about the request.</li>
<li><code>auth</code> <code>{strategy}</code> - the request successfully authenticated with the listed strategy.</li>
<li><code>auth</code> <code>unauthenticated</code> - no authentication scheme included with the request.</li>
<li><code>auth</code> <code>unauthenticated</code> <code>response</code> <code>{strategy}</code> - the authentication strategy listed returned a
non-error response (e.g. a redirect to a login page).</li>
<li><code>auth</code> <code>unauthenticated</code> <code>error</code> <code>{strategy}</code> - the request failed to pass the listed
authentication strategy (invalid credentials).</li>
<li><code>auth</code> <code>unauthenticated</code> <code>missing</code> <code>{strategy}</code> - the request failed to pass the listed
authentication strategy (no credentials found).</li>
<li><code>auth</code> <code>unauthenticated</code> <code>try</code> <code>{strategy}</code> - the request failed to pass the listed
authentication strategy in <code>&apos;try&apos;</code> mode and will continue.</li>
<li><code>auth</code> <code>scope</code> <code>error</code> <code>{strategy}</code> - the request authenticated but failed to meet the scope
requirements.</li>
<li><code>auth</code> <code>entity</code> <code>user</code> <code>error</code> <code>{strategy}</code> - the request authenticated but included an
application entity when a user entity was required.</li>
<li><code>auth</code> <code>entity</code> <code>app</code> <code>error</code> <code>{strategy}</code> - the request authenticated but included a user
entity when an application entity was required.</li>
<li><code>handler</code> - the route handler executed. Includes the execution duration.</li>
<li><code>handler</code> <code>error</code> - the route handler returned an error. Includes the execution duration and the
error message.</li>
<li><code>handler</code> <code>method</code> {method} - a string-shortcut handler method was executed (when cache enabled).
Includes information about the execution including cache performance.</li>
<li><code>pre</code> <code>method</code> {method} - a string-shortcut pre method was executed (when cache enabled).
Includes information about the execution including cache performance.</li>
<li><code>pre</code> - a pre method was executed. Includes the execution duration and assignment key.</li>
<li><code>pre</code> <code>error</code> - a pre method was executed and returned an error. Includes the execution duration,
assignment key, and error.</li>
<li><code>internal</code> <code>error</code> - an HTTP 500 error response was assigned to the request.</li>
<li><code>internal</code> <code>implementation</code> <code>error</code> - a function provided by the user failed with an exception
during request execution.</li>
<li><code>request</code> <code>closed</code> <code>error</code> - the request closed prematurely.</li>
<li><code>request</code> <code>error</code> - the request stream emitted an error. Includes the error.</li>
<li><code>request</code> <code>server</code> <code>timeout</code> <code>error</code> - the request took too long to process by the server.
Includes the timeout configuration value and the duration.</li>
<li><code>tail</code> <code>add</code> - a request tail was added. Includes the tail name and id.</li>
<li><code>tail</code> <code>remove</code> - a request tail was removed. Includes the tail name and id.</li>
<li><code>tail</code> <code>remove</code> <code>last</code> - the last request tail was removed. Includes the tail name and id.</li>
<li><code>tail</code> <code>remove</code> <code>error</code> - failed to remove a request tail (already removed). Includes the tail
name and id.</li>
<li><code>state</code> <code>error</code> - the request included an invalid cookie or cookies. Includes the cookies and
error details.</li>
<li><code>state</code> <code>response</code> <code>error</code> - the response included an invalid cookie which prevented generating a
valid header. Includes the error.</li>
<li><code>payload</code> <code>error</code> - failed processing the request payload. Includes the error.</li>
<li><code>response</code> - the response was sent successfully.</li>
<li><code>response</code> <code>error</code> - failed writing the response to the client. Includes the error.</li>
<li><code>response</code> <code>error</code> <code>close</code> - failed writing the response to the client due to prematurely closed
connection.</li>
<li><code>response</code> <code>error</code> <code>aborted</code> - failed writing the response to the client due to prematurely
aborted connection.</li>
<li><code>validation</code> <code>error</code> <code>{input}</code> - input (i.e. payload, query, params, headers) validation failed.
Includes the error.</li>
<li><code>validation</code> <code>response</code> <code>error</code> - response validation failed. Includes the error message.</li>
</ul>

<h5><a id="server-logs" class="anchor" href="#server-logs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server logs</h5>

<p>Emitted by the server <code>&apos;log&apos;</code> event:</p>

<ul>
<li><code>load</code> - logs the current server load measurements when the server rejects a request due to high
load. The event data contains the metrics.</li>
<li><code>internal</code> <code>implementation</code> <code>error</code> - a function provided by the user failed with an exception
during request execution. The log appears under the server logs when the exception cannot be
associated with the request that generated it.</li>
<li><code>connection</code> <code>client</code> <code>error</code> - a <code>clientError</code> event was received from the HTTP or HTTPS
listener. The event data is the error object received.</li>
</ul>

<h2><a id="plugins" class="anchor" href="#plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plugins</h2>

<p>Plugins provide a way to organize the application code by splitting the server logic into smaller
components. Each plugin can manipulate the server and its connections through the standard server
interface, but with the added ability to sandbox certain properties.</p>

<p>A plugin is a function with the signature <code>function(server, options, next)</code> where:</p>

<ul>
<li><code>server</code> - the server object the plugin is being registered to.</li>
<li><code>options</code> - an options object passed to the plugin during registration.</li>
<li><code>next</code> - a callback method the function must call to return control back to the framework to
complete the registration process with signature <code>function(err)</code> where:

<ul>
<li><code>err</code> - any plugin registration error.</li>
</ul></li>
</ul>

<p>The plugin function must include an <code>attributes</code> function property with the following:</p>

<ul>
<li><code>name</code> - required plugin name string. The name is used as a unique key. Published
<a href="#plugins" id="">plugins</a> should  use the same name as the name field in the &apos;package.json&apos; file. Names
must be unique within each application.</li>
<li><code>version</code> - optional plugin version. The version is only used informatively to enable other
<a href="#plugins" id="">plugins</a> to find out the versions loaded. The version should be the same as the one
specified in the plugin&apos;s &apos;package.json&apos; file.</li>
<li><code>multiple</code> - if <code>true</code>, allows the plugin to be registered multiple times with the same server.
Defaults to <code>false</code>.</li>
<li><code>dependencies</code> - optional string or array of string indicating a plugin dependency. Same as
setting dependencies via <a href="#serverdependencydependencies-after" id=""><code>server.dependency()</code></a>.</li>
<li><code>connections</code> - if <code>false</code>, does not allow the plugin to call server APIs that modify the
connections such as adding a route or configuring state. This flag allows the plugin to be
registered before connections are added and to pass dependency requirements. Defaults to <code>true</code>.</li>
<li><code>once</code> - if <code>true</code>, will only register the plugin once per connection (or once per server for a
connectionless plugin). If set, overrides the <code>once</code> option passed to <code>server.register()</code>.
Defaults to <code>undefined</code> (registration will be based on the <code>server.register()</code> option <code>once</code>).</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">register</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">server</span>, <span class="pl-smi">options</span>, <span class="pl-smi">next</span>) {

    server.route({
        method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
        path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>,
        <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span>);
        }
    });

    <span class="pl-k">return</span> next();
};

register.<span class="pl-c1">attributes</span> <span class="pl-k">=</span> {
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span>,
    version<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>1.0.0<span class="pl-pds">&apos;</span></span>
};</pre></div>

<p>Alternatively, the <code>name</code> and <code>version</code> can be included via the <code>pkg</code> attribute containing the
&apos;package.json&apos; file for the module which already has the name and version included:</p>

<div class="highlight highlight-source-js"><pre>register.<span class="pl-c1">attributes</span> <span class="pl-k">=</span> {
    pkg<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>./package.json<span class="pl-pds">&apos;</span></span>)
};</pre></div>

<h2><a id="requests" class="anchor" href="#requests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requests</h2>

<p>Incoming requests are handled by the server via routes. Each route describes an HTTP endpoint with
a path, method, and other properties. The route logic is divided between static configuration,
prerequisite functions and a route handler function. Routes are added via the
<a href="#serverrouteoptions" id=""><code>server.route()</code></a> method.</p>

<h3><a id="request-lifecycle" class="anchor" href="#request-lifecycle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request lifecycle</h3>

<p>Each incoming request passes through a pre-defined list of steps, along with optional
<a href="#serverextevent-method-options" id="">extensions</a>:</p>

<ul>
<li><strong><code>&apos;onRequest&apos;</code></strong> extension point

<ul>
<li>always called</li>
<li>the <a href="#request-object" id="">request object</a> passed to the extension functions is decorated with the
<a href="#requestseturlurl" id=""><code>request.setUrl()</code></a> and <a href="#requestsetmethodmethod" id=""><code>request.setMethod()</code></a>
methods. Calls to these methods will impact how the request is routed and can be used for
rewrite rules.</li>
<li><code>request.route</code> is not yet populated at this point.</li>
<li>JSONP configuration is ignored for any response returned from the extension point since no
route is matched yet and the JSONP configuration is unavailable.</li>
</ul></li>
<li>Lookup route using request path

<ul>
<li>if no route is found or if the path violates the HTTP specification, skips to the
<strong><code>&apos;onPreResponse&apos;</code></strong> extension point.</li>
</ul></li>
<li>Process query extensions (e.g. JSONP)</li>
<li>Parse cookies</li>
<li><strong><code>&apos;onPreAuth&apos;</code></strong> extension point</li>
<li>Authenticate request</li>
<li>Read and parse payload</li>
<li>Authenticate request payload</li>
<li><strong><code>&apos;onPostAuth&apos;</code></strong> extension point</li>
<li>Validate path parameters</li>
<li>Validate query</li>
<li>Validate payload</li>
<li><strong><code>&apos;onPreHandler&apos;</code></strong> extension point</li>
<li><a href="#route-prerequisites" id="">Route prerequisites</a></li>
<li>Route handler</li>
<li><strong><code>&apos;onPostHandler&apos;</code></strong> extension point

<ul>
<li>The response object contained in <code>request.response</code> may be modified (but not assigned a new
value). To return a different response type (for example, replace an error with an HTML
response), return a new response via <code>reply(response)</code>.</li>
</ul></li>
<li>Validate response payload</li>
<li><strong><code>&apos;onPreResponse&apos;</code></strong> extension point

<ul>
<li>always called (except when <a href="#replycloseoptions" id=""><code>reply.close()</code></a> is called or the client
terminates the connection prematurely).</li>
<li>The response contained in <code>request.response</code> may be modified (but not assigned a new value).
To return a different response type (for example, replace an error with an HTML response),
return a new response via <code>reply(response)</code>. Note that any errors generated after
<code>reply(response)</code> is called will not be passed back to the <code>&apos;onPreResponse&apos;</code> extension method
to prevent an infinite loop.</li>
</ul></li>
<li>Send response (may emit <code>&apos;request-error&apos;</code> event)</li>
<li>Emits <code>&apos;response&apos;</code> event</li>
<li>Wait for tails</li>
<li>Emits <code>&apos;tail&apos;</code> event</li>
</ul>

<h3><a id="route-configuration" class="anchor" href="#route-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route configuration</h3>

<p>The route configuration object supports the following options:</p>

<ul>
<li><p><code>path</code> - (required) the absolute path used to match incoming requests (must begin with &apos;/&apos;).
Incoming requests are compared to the configured paths based on the connection
<a href="#connection.config.router" id=""><code>router</code></a> configuration option. The path can include named parameters
enclosed in <code>{}</code> which  will be matched against literal values in the request as described in
<a href="#path-parameters" id="">Path parameters</a>.</p></li>
<li><p><code>method</code> - (required) the HTTP method. Typically one of &apos;GET&apos;, &apos;POST&apos;, &apos;PUT&apos;, &apos;PATCH&apos;, &apos;DELETE&apos;,
or &apos;OPTIONS&apos;. Any HTTP method is allowed, except for &apos;HEAD&apos;. Use <code>&apos;*&apos;</code> to match against any HTTP
method (only when an exact match was not found, and any match with a specific method will be
given a higher priority over a wildcard match). Can be assigned an array of methods which has the
same result as adding the same route with different methods manually.</p></li>
<li><p><code>vhost</code> - an optional domain string or an array of domain strings for limiting the route to only
requests with a matching host header field. Matching is done against the hostname part of the
header only (excluding the port). Defaults to all hosts.</p></li>
<li><p><code>handler</code> - (required) the function called to generate the response after successful
authentication and validation. The handler function is described in
<a href="#route-handler" id="">Route handler</a>. If set to a string, the value is parsed the same way a
prerequisite server method string shortcut is processed. Alternatively, <code>handler</code> can be assigned
an object with a single key using the name of a registered handler type and value with the
options passed to the registered handler.</p></li>
<li><p><code>config</code> - additional <a href="#route-options" id="">route options</a>.</p></li>
</ul>

<p>Note that the <code>options</code> object is deeply cloned (with the exception of <code>bind</code> which is shallowly
copied) and cannot contain any values that are unsafe to perform deep copy on.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-c">// Handler in top level</span>

<span class="pl-k">const</span> <span class="pl-c1">status</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>ok<span class="pl-pds">&apos;</span></span>);
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/status<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> status });

<span class="pl-c">// Handler in config</span>

<span class="pl-k">const</span> <span class="pl-c1">user</span> <span class="pl-k">=</span> {
    cache<span class="pl-k">:</span> { expiresIn<span class="pl-k">:</span> <span class="pl-c1">5000</span> },
    <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply({ name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>John<span class="pl-pds">&apos;</span></span> });
    }
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/user<span class="pl-pds">&apos;</span></span>, config<span class="pl-k">:</span> user });</pre></div>

<h4><a id="route-options" class="anchor" href="#route-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route options</h4>

<p>Each route can be customized to change the default behavior of the request lifecycle using the
following options:</p>

<ul>
<li><p><code>app</code> - application-specific configuration. Should not be used by <a href="#plugins" id="">plugins</a> which
should use <code>plugins[name]</code> instead.</p></li>
<li><p><a name="user-content-route.config.auth" id=""></a><code>auth</code> - authentication configuration. Value can be:</p>

<ul>
<li><code>false</code> to disable authentication if a default strategy is set.</li>
<li>a string with the name of an authentication strategy registered with
<a href="#serverauthstrategyname-scheme-mode-options" id=""><code>server.auth.strategy()</code></a>.</li>
<li>an object with:

<ul>
<li><code>mode</code> - the authentication mode. Defaults to <code>&apos;required&apos;</code> if a server authentication
strategy is configured, otherwise defaults to no authentication. Available values:

<ul>
<li><code>&apos;required&apos;</code> - authentication is required.</li>
<li><code>&apos;optional&apos;</code> - authentication is optional (must be valid if present).</li>
<li><code>&apos;try&apos;</code> - same as <code>&apos;optional&apos;</code> but allows for invalid authentication.</li>
</ul></li>
<li><code>strategies</code> - a string array of strategy names in order they should be attempted. If
only one strategy is used, <code>strategy</code> can be used instead with the single string
value. Defaults to the default authentication strategy which is available only when a
single strategy is configured.</li>
<li><code>payload</code> - if set, the payload (in requests other than &apos;GET&apos; and &apos;HEAD&apos;) is
authenticated after it is processed. Requires a strategy with payload authentication
support (e.g. Hawk). Cannot be set to a value
other than <code>&apos;required&apos;</code> when the scheme sets the <code>options.payload</code> to <code>true</code>.
Available values:

<ul>
<li><code>false</code> - no payload authentication. This is the default value.</li>
<li><code>&apos;required&apos;</code> - payload authentication required. This is the default value when
the scheme sets <code>options.payload</code> to <code>true</code>.</li>
<li><code>&apos;optional&apos;</code> - payload authentication performed only when the client includes
payload authentication information (e.g. <code>hash</code> attribute in Hawk).</li>
</ul></li>
<li><code>scope</code> - the application scope required to access the route. Value can be a scope
string or an array of scope strings. The authenticated credentials object <code>scope</code>
property must contain at least one of the scopes defined to access the route.
You may also access properties on the request object (<code>query</code> and <code>params</code>} to populate a
dynamic scope by using <code>{}</code> characters around the property name, such as
<code>&apos;user-{params.id}&apos;</code>. Set to <code>false</code> to remove scope requirements. Defaults to no scope
required.</li>
<li><code>entity</code> - the required authenticated entity type. If set, must match the <code>entity</code>
value of the authentication credentials. Available values:

<ul>
<li><code>any</code> - the authentication can be on behalf of a user or application. This is the
default value.</li>
<li><code>user</code> - the authentication must be on behalf of a user.</li>
<li><code>app</code> - the authentication must be on behalf of an application.</li>
</ul></li>
</ul></li>
</ul></li>
<li><p><code>bind</code> - an object passed back to the provided <code>handler</code> (via <code>this</code>) when called.
Ignored if the method is an arrow function.</p></li>
<li><p><code>cache</code> - if the route method is &apos;GET&apos;, the route can be configured to include caching
directives in the response using the following options:</p>

<ul>
<li><code>privacy</code> - determines the privacy flag included in client-side caching using the
&apos;Cache-Control&apos; header. Values are:

<ul>
<li><code>&apos;default&apos;</code> - no privacy flag. This is the default setting.</li>
<li><code>&apos;public&apos;</code> - mark the response as suitable for public caching.</li>
<li><code>&apos;private&apos;</code> - mark the response as suitable only for private caching.</li>
</ul></li>
<li><code>expiresIn</code> - relative expiration expressed in the number of milliseconds since the
item was saved in the cache. Cannot be used together with <code>expiresAt</code>.</li>
<li><code>expiresAt</code> - time of day expressed in 24h notation using the &apos;HH:MM&apos; format, at which
point all cache records for the route expire. Cannot be used together with <code>expiresIn</code>.</li>
<li><code>statuses</code> - an array of HTTP response status codes (e.g. <code>200</code>) which are allowed to include
a valid caching directive. Defaults to <code>[200]</code>.</li>
</ul></li>
<li><p><code>cors</code> - the <a href="http://www.w3.org/TR/cors/" id="">Cross-Origin Resource Sharing</a> protocol allows
browsers to make cross-origin API calls. CORS is required by web applications running
inside a browser which are loaded from a different domain than the API server. CORS
headers are disabled by default (<code>false</code>). To enable, set <code>cors</code> to <code>true</code>, or to an object
with the following options:</p>

<ul>
<li><code>origin</code> - a strings array of allowed origin servers (&apos;Access-Control-Allow-Origin&apos;).
The array can contain any combination of fully qualified origins along with origin
strings containing a wildcard &apos;<em>&apos; character, or a single `&apos;</em>&apos;<code>origin string. Defaults
to any origin</code>[&apos;*&apos;]`.</li>
<li><code>maxAge</code> - number of seconds the browser should cache the CORS response
(&apos;Access-Control-Max-Age&apos;). The greater the value, the longer it will take before the
browser checks for changes in policy. Defaults to <code>86400</code> (one day).</li>
<li><code>headers</code> - a strings array of allowed headers (&apos;Access-Control-Allow-Headers&apos;).
Defaults to <code>[&apos;Accept&apos;, &apos;Authorization&apos;, &apos;Content-Type&apos;, &apos;If-None-Match&apos;]</code>.</li>
<li><code>additionalHeaders</code> - a strings array of additional headers to <code>headers</code>. Use this to
keep the default headers in place.</li>
<li><code>exposedHeaders</code> - a strings array of exposed headers
(&apos;Access-Control-Expose-Headers&apos;). Defaults to
<code>[&apos;WWW-Authenticate&apos;, &apos;Server-Authorization&apos;]</code>.</li>
<li><code>additionalExposedHeaders</code> - a strings array of additional headers to
<code>exposedHeaders</code>. Use this to keep the default headers in place.</li>
<li><code>credentials</code> - if <code>true</code>, allows user credentials to be sent
(&apos;Access-Control-Allow-Credentials&apos;). Defaults to <code>false</code>.</li>
</ul></li>
<li><p><code>ext</code> - defined a route-level <a href="#request-lifecycle" id="">request extension points</a> by setting
the option to an object with a key for each of the desired extension points (<code>&apos;onRequest&apos;</code>
is not allowed), and the value is the same as the <a href="#serverextevents" id=""><code>server.ext(events)</code></a>
<code>event</code> argument.</p></li>
<li><p><a name="user-content-route.config.files" id=""></a><code>files</code> - defines the behavior for accessing files:</p>

<ul>
<li><code>relativeTo</code> - determines the folder relative paths are resolved against.</li>
</ul></li>
<li><p><code>handler</code> - an alternative location for the route <code>handler</code> option.</p></li>
<li><p><code>id</code> - an optional unique identifier used to look up the route using
<a href="#serverlookupid" id=""><code>server.lookup()</code></a>. Cannot be assigned to routes with an array of methods.</p></li>
<li><p><code>isInternal</code> - if <code>true</code>, the route cannot be accessed through the HTTP connection but only
through the <code>server.inject()</code> interface with the <code>allowInternals</code> option set to <code>true</code>. Used
for internal routes that should not be accessible to the outside world. Defaults to <code>false</code>.</p></li>
<li><p><code>json</code> - optional arguments passed to <code>JSON.stringify()</code> when converting an object or
error response to a string payload. Supports the following:</p>

<ul>
<li><code>replacer</code> - the replacer function or array. Defaults to no action.</li>
<li><code>space</code> - number of spaces to indent nested object keys. Defaults to no indentation.</li>
<li><code>suffix</code> - string suffix added after conversion to JSON string. Defaults to no suffix.</li>
</ul></li>
<li><p><code>jsonp</code> - enables JSONP support by setting the value to the query parameter name containing
the function name used to wrap the response payload. For example, if the value is
<code>&apos;callback&apos;</code>, a request comes in with <code>&apos;callback=me&apos;</code>, and the JSON response is
<code>&apos;{ &quot;a&quot;:&quot;b&quot; }&apos;</code>, the payload will be <code>&apos;me({ &quot;a&quot;:&quot;b&quot; });&apos;</code>. Does not work with stream
responses. Headers <code>content-type</code> and <code>x-content-type-options</code> are set to
<code>text/javascript</code> and <code>nosniff</code> respectively, and will override those
headers even if explicitly set by <code>response.type()</code></p></li>
<li><p><code>payload</code> - determines how the request payload is processed:</p>

<ul>
<li><code>output</code> - the type of payload representation requested. The value must be one of:

<ul>
<li><code>&apos;data&apos;</code> - the incoming payload is read fully into memory. If <code>parse</code> is <code>true</code>, the
payload is parsed (JSON, form-decoded, multipart) based on the &apos;Content-Type&apos; header.
If <code>parse</code> is false, the raw <code>Buffer</code> is returned. This is the default value except
when a proxy handler is used.</li>
<li><code>&apos;stream&apos;</code> - the incoming payload is made available via a <code>Stream.Readable</code>
interface. If the payload is &apos;multipart/form-data&apos; and <code>parse</code> is <code>true</code>, fields
values are presented as text while files are provided as streams. File streams from a
&apos;multipart/form-data&apos; upload will also have a property <code>hapi</code> containing <code>filename</code>
and <code>headers</code> properties.</li>
<li><code>&apos;file&apos;</code> - the incoming payload is written to temporary file in the directory
specified by the server&apos;s <code>payload.uploads</code> settings. If the payload is
&apos;multipart/form-data&apos; and <code>parse</code> is <code>true</code>, fields values are presented as text
while files are saved. Note that it is the sole responsibility of the application to
clean up the files generated by the framework. This can be done by keeping track
of which files are used (e.g. using the <code>request.app</code> object), and listening to
the server <code>&apos;response&apos;</code> event to perform any needed cleanup.</li>
</ul></li>
<li><code>parse</code> - can be <code>true</code>, <code>false</code>, or <code>gunzip</code>; determines if the incoming payload is
processed or presented raw. <code>true</code> and <code>gunzip</code> includes gunzipping when the appropriate
&apos;Content-Encoding&apos; is specified on the received request. If parsing is enabled and the
&apos;Content-Type&apos; is known (for the whole payload as well as parts), the payload is
converted into an object when possible. If the format is unknown, a Bad Request (400)
error response is sent. Defaults to <code>true</code>, except when a proxy handler is used. The
supported mime types are:

<ul>
<li>application/json</li>
<li>application/x-www-form-urlencoded</li>
<li>application/octet-stream</li>
<li>text/*</li>
<li>multipart/form-data</li>
</ul></li>
<li><code>allow</code> - a string or an array of strings with the allowed mime types for the endpoint.
Defaults to any of the supported mime types listed above. Note that allowing other mime
types not listed will not enable them to be parsed, and that if parsing mode is
<code>&apos;parse&apos;</code>, the request will result in an error response.</li>
<li><code>override</code> - a mime type string overriding the &apos;Content-Type&apos; header value received.
Defaults to no override.</li>
<li><code>maxBytes</code> - limits the size of incoming payloads to the specified byte count.
Allowing very large payloads may cause the server to run out of memory. Defaults to
<code>1048576</code> (1MB).</li>
<li><code>timeout</code> - payload reception timeout in milliseconds. Sets the maximum time allowed for the
client to transmit the request payload (body) before giving up and responding with a Request
Timeout (408) error response. Set to <code>false</code> to disable. Defaults to <code>10000</code> (10 seconds).</li>
<li><code>uploads</code> - the directory used for writing file uploads. Defaults to <code>os.tmpDir()</code>.</li>
<li><code>failAction</code> - determines how to handle payload parsing errors. Allowed values are:

<ul>
<li><code>&apos;error&apos;</code> - return a Bad Request (400) error response. This is the default value.</li>
<li><code>&apos;log&apos;</code> - report the error but continue processing the request.</li>
<li><code>&apos;ignore&apos;</code> - take no action and continue processing the request.</li>
</ul></li>
<li><code>qs</code> - optional parsing options object passed to the <a href="https://github.com/hapijs/qs" id=""><strong>qs</strong> module</a>.</li>
<li><code>defaultContentType</code> - the default &apos;Content-Type&apos; HTTP header value is not present.
Defaults to <code>&apos;application/json&apos;</code>.</li>
</ul></li>
<li><p><code>plugins</code> - plugin-specific configuration. <code>plugins</code> is an object where each key is a plugin
name and the value is the plugin configuration.</p></li>
<li><p><code>pre</code> - an array with <a href="#route-prerequisites" id="">route prerequisites</a> methods which are executed
in serial or in parallel before the handler is called.</p></li>
<li><p><code>response</code> - processing rules for the outgoing response:</p>

<ul>
<li><code>emptyStatusCode</code> - the default HTTP status code when the payload is empty. Value can
be <code>200</code> or <code>204</code>. Note that a <code>200</code> status code is converted to a <code>204</code> only at the time
or response transmission (the response status code will remain <code>200</code> throughout the
request lifecycle unless manually set). Defaults to <code>200</code>.</li>
<li><code>schema</code> - the default response payload validation rules (for all non-error responses)
expressed as one of:

<ul>
<li><code>true</code> - any payload allowed (no validation performed). This is the default.</li>
<li><code>false</code> - no payload allowed.</li>
<li>a <a href="http://github.com/hapijs/joi" id="">Joi</a> validation object. This will receive the request&apos;s
headers, params, query, payload, and auth credentials and isAuthenticated flags as context.</li>
<li>a validation function using the signature <code>function(value, options, next)</code> where:

<ul>
<li><code>value</code> - the object containing the response object.</li>
<li><code>options</code> - the server validation options, merged with an object containing the request&apos;s
headers, params, payload, and auth credentials object and isAuthenticated flag.</li>
<li><code>next(err)</code> - the callback function called when validation is completed.</li>
</ul></li>
</ul></li>
<li><code>status</code> - HTTP status-code-specific payload validation rules. The <code>status</code> key is set to an
object where each key is a 3 digit HTTP status code and the value has the same
definition as <code>schema</code>. If a response status code is not present in the <code>status</code> object,
the <code>schema</code> definition is used, expect for errors which are not validated by default.</li>
<li><code>sample</code> - the percent of response payloads validated (0 - 100). Set to <code>0</code> to disable all
validation. Defaults to <code>100</code> (all response payloads).</li>
<li><code>failAction</code> - defines what to do when a response fails payload validation. Options are:

<ul>
<li><code>error</code> - return an Internal Server Error (500) error response. This is the default
value.</li>
<li><code>log</code> - log the error but send the response.</li>
</ul></li>
<li><code>modify</code> - if <code>true</code>, applies the validation rule changes to the response payload. Defaults to
<code>false</code>.</li>
<li><code>options</code> - options to pass to <a href="http://github.com/hapijs/joi" id="">Joi</a>. Useful to set
global options such as <code>stripUnknown</code> or <code>abortEarly</code> (the complete list is available
<a href="https://github.com/hapijs/joi/blob/master/API.md#validatevalue-schema-options-callback" id="">here</a>).
Defaults to no options.</li>
</ul></li>
<li><p><code>security</code> - sets common security headers (disabled by default). To enable set <code>security</code> to
<code>true</code> or to an object with the following options:</p>

<ul>
<li><code>hsts</code> - controls the &apos;Strict-Transport-Security&apos; header. If set to <code>true</code> the header
will be set to <code>max-age=15768000</code>, if specified as a number the maxAge parameter will
be set to that number. Defaults to <code>true</code>. You may also specify an object with the
following fields:

<ul>
<li><code>maxAge</code> - the max-age portion of the header, as a number. Default is <code>15768000</code>.</li>
<li><code>includeSubDomains</code> - a boolean specifying whether to add the <code>includeSubDomains</code>
flag to the header.</li>
<li><code>preload</code> - a boolean specifying whether to add the &apos;preload&apos; flag (used to submit
domains inclusion in Chrome&apos;s HTTP Strict Transport Security (HSTS) preload list)
to the header.</li>
</ul></li>
<li><code>xframe</code> - controls the &apos;X-Frame-Options&apos; header. When set to <code>true</code> the header will
be set to <code>DENY</code>, you may also specify a string value of &apos;deny&apos; or &apos;sameorigin&apos;. To
use the &apos;allow-from&apos; rule, you must set this to an object with the following fields:

<ul>
<li><code>rule</code> - either &apos;deny&apos;, &apos;sameorigin&apos;, or &apos;allow-from&apos;</li>
<li><code>source</code> - when <code>rule</code> is &apos;allow-from&apos; this is used to form the rest of the
header, otherwise this field is ignored. If <code>rule</code> is &apos;allow-from&apos; but <code>source</code>
is unset, the rule will be automatically changed to &apos;sameorigin&apos;.</li>
</ul></li>
<li><code>xss</code> - boolean that controls the &apos;X-XSS-PROTECTION&apos; header for IE. Defaults to
<code>true</code> which sets the header to equal &apos;1; mode=block&apos;. NOTE: This setting can create
a security vulnerability in versions of IE below 8, as well as unpatched versions of
IE8. See <a href="http://hackademix.net/2009/11/21/ies-xss-filter-creates-xss-vulnerabilities/" id="">here</a>
and <a href="https://technet.microsoft.com/library/security/ms10-002" id="">here</a> for more
information. If you actively support old versions of IE, it may be wise to explicitly
set this flag to <code>false</code>.</li>
<li><code>noOpen</code> - boolean controlling the &apos;X-Download-Options&apos; header for IE, preventing
downloads from executing in your context. Defaults to <code>true</code> setting the header to
&apos;noopen&apos;.</li>
<li><code>noSniff</code> - boolean controlling the &apos;X-Content-Type-Options&apos; header. Defaults to
<code>true</code> setting the header to its only and default option, &apos;nosniff&apos;.</li>
</ul></li>
<li><p><a name="user-content-route.config.state" id=""></a><code>state</code> - HTTP state management (cookies) allows
the server to store information on the client which is sent back to the server with every
request (as defined in <a href="https://tools.ietf.org/html/rfc6265" id="">RFC 6265</a>). <code>state</code> supports
the following options:</p>

<ul>
<li><code>parse</code> - determines if incoming &apos;Cookie&apos; headers are parsed and stored in the
<code>request.state</code> object. Defaults to <code>true</code>.</li>
<li><code>failAction</code> - determines how to handle cookie parsing errors. Allowed values are:

<ul>
<li><code>&apos;error&apos;</code> - return a Bad Request (400) error response. This is the default value.</li>
<li><code>&apos;log&apos;</code> - report the error but continue processing the request.</li>
<li><code>&apos;ignore&apos;</code> - take no action.</li>
</ul></li>
</ul></li>
<li><p><code>validate</code> - request input validation rules for various request components. When using a
<a href="http://github.com/hapijs/joi" id="">Joi</a> validation object, the values of the other inputs (i.e.
<code>headers</code>, <code>query</code>, <code>params</code>, <code>payload</code>, and <code>auth</code>) are made available under the validation
context (accessible in rules as <code>Joi.ref(&apos;$query.key&apos;)</code>). Note that validation is performed in
order (i.e. headers, params, query, payload) and if type casting is used (converting a string to
number), the value of inputs not yet validated will reflect the raw, unvalidated and unmodified
values. The <code>validate</code> object supports:</p>

<ul>
<li><p><code>headers</code> - validation rules for incoming request headers. Values allowed:</p>

<ul>
<li><code>true</code> - any headers allowed (no validation performed).  This is the default.</li>
<li><code>false</code> - no headers allowed (this will cause all valid HTTP requests to fail).</li>
<li>a <a href="http://github.com/hapijs/joi" id="">Joi</a> validation object.</li>
<li>a validation function using the signature <code>function(value, options, next)</code> where:

<ul>
<li><code>value</code> - the object containing the request headers.</li>
<li><code>options</code> - the server validation options.</li>
<li><code>next(err, value)</code> - the callback function called when validation is completed.</li>
</ul></li>
</ul></li>
<li><p><code>params</code> - validation rules for incoming request path parameters, after matching the path
against the route and extracting any parameters then stored in <code>request.params</code>. Values
allowed:</p>

<ul>
<li><code>true</code> - any path parameters allowed (no validation performed).  This is the default.</li>
<li><code>false</code> - no path variables allowed.</li>
<li>a <a href="http://github.com/hapijs/joi" id="">Joi</a> validation object.</li>
<li>a validation function using the signature <code>function(value, options, next)</code> where:

<ul>
<li><code>value</code> - the object containing the path parameters.</li>
<li><code>options</code> - the server validation options.</li>
<li><code>next(err, value)</code> - the callback function called when validation is completed.</li>
</ul></li>
</ul></li>
<li><p><code>query</code> - validation rules for an incoming request URI query component (the key-value
part of the URI between &apos;?&apos; and &apos;#&apos;). The query is parsed into its individual key-value
pairs (using the <a href="https://github.com/hapijs/qs" id=""><strong>qs</strong> module</a>) and stored in
<code>request.query</code> prior to validation. Values allowed:</p>

<ul>
<li><code>true</code> - any query parameters allowed (no validation performed). This is the default.</li>
<li><code>false</code> - no query parameters allowed.</li>
<li>a <a href="http://github.com/hapijs/joi" id="">Joi</a> validation object.</li>
<li>a validation function using the signature <code>function(value, options, next)</code> where:

<ul>
<li><code>value</code> - the object containing the query parameters.</li>
<li><code>options</code> - the server validation options.</li>
<li><code>next(err, value)</code> - the callback function called when validation is completed.</li>
</ul></li>
</ul></li>
<li><p><code>payload</code> - validation rules for an incoming request payload (request body). Values
allowed:</p>

<ul>
<li><code>true</code> - any payload allowed (no validation performed). This is the default.</li>
<li><code>false</code> - no payload allowed.</li>
<li>a <a href="http://github.com/hapijs/joi" id="">Joi</a> validation object. Note that empty payloads
are represented by a <code>null</code> value. If a validation schema is provided and empty
payload are supported, it must be explicitly defined by setting the <code>payload</code> value
to a <strong>joi</strong> schema with <code>null</code> allowed (e.g. <code>Joi.object({ /* keys here */ }).allow(null)</code>).</li>
<li>a validation function using the signature <code>function(value, options, next)</code> where:

<ul>
<li><code>value</code> - the object containing the payload object.</li>
<li><code>options</code> - the server validation options.</li>
<li><code>next(err, value)</code> - the callback function called when validation is completed.</li>
</ul></li>
</ul></li>
<li><p><code>errorFields</code> - an optional object with error fields copied into every validation error
response.</p></li>
<li><p><code>failAction</code> - determines how to handle invalid requests. Allowed values are:</p>

<ul>
<li><code>&apos;error&apos;</code> - return a Bad Request (400) error response. This is the default value.</li>
<li><code>&apos;log&apos;</code> - log the error but continue processing the request.</li>
<li><code>&apos;ignore&apos;</code> - take no action.</li>
<li>a custom error handler function with the signature
<code>function(request, reply, source, error)</code> where:

<ul>
<li><code>request</code> - the <a href="#request-object" id="">request object</a>.</li>
<li><code>reply</code> - the continuation <a href="#reply-interface" id="">reply interface</a>.</li>
<li><code>source</code> - the source of the invalid field (e.g. <code>&apos;headers&apos;</code>, <code>&apos;params&apos;</code>, <code>&apos;query&apos;</code>,
<code>&apos;payload&apos;</code>).</li>
<li><code>error</code> - the error object prepared for the client response (including the
validation function error under <code>error.data</code>).</li>
</ul></li>
</ul></li>
<li><p><code>options</code> - options to pass to <a href="http://github.com/hapijs/joi" id="">Joi</a>. Useful to set
global options such as <code>stripUnknown</code> or <code>abortEarly</code> (the complete list is available
<a href="https://github.com/hapijs/joi/blob/master/API.md#validatevalue-schema-options-callback" id="">here</a>).
Defaults to no options.</p></li>
</ul></li>
<li><p><code>timeout</code> - define timeouts for processing durations:</p>

<ul>
<li><code>server</code> - response timeout in milliseconds. Sets the maximum time allowed for the
server to respond to an incoming client request before giving up and responding with
a Service Unavailable (503) error response. Disabled by default (<code>false</code>).</li>
<li><code>socket</code> - by default, node sockets automatically timeout after 2 minutes. Use this
option to override this behavior. Defaults to <code>undefined</code> which leaves the node
default unchanged. Set to <code>false</code> to disable socket timeouts.</li>
</ul></li>
</ul>

<p>The following documentation options are also available when adding new routes (they are not
available when setting defaults):</p>

<ul>
<li><code>description</code> - route description used for generating documentation (string).</li>
<li><code>notes</code> - route notes used for generating documentation (string or array of strings).</li>
<li><code>tags</code> - route tags used for generating documentation (array of strings).</li>
</ul>

<h4><a id="route-public-interface" class="anchor" href="#route-public-interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route public interface</h4>

<p>When route information is returned or made available as a property, it is an object with the
following:</p>

<ul>
<li><code>method</code> - the route HTTP method.</li>
<li><code>path</code> - the route path.</li>
<li><code>vhost</code> - the route vhost option if configured.</li>
<li><code>realm</code> - the <a href="#serverrealm" id="">active realm</a> associated with the route.</li>
<li><code>settings</code> - the <a href="#route-options" id="">route options</a> object with all defaults applied.</li>
</ul>

<h3><a id="path-parameters" class="anchor" href="#path-parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Path parameters</h3>

<p>Parameterized paths are processed by matching the named parameters to the content of the incoming
request path at that path segment. For example, &apos;/book/{id}/cover&apos; will match &apos;/book/123/cover&apos; and
<code>request.params.id</code> will be set to <code>&apos;123&apos;</code>. Each path segment (everything between the opening &apos;/&apos;
and the closing &apos;/&apos; unless it is the end of the path) can only include one named parameter. A
parameter can cover the entire segment (&apos;/{param}&apos;) or part of the segment (&apos;/file.{ext}&apos;).</p>

<p>An optional &apos;?&apos; suffix following the parameter name indicates an optional parameter (only allowed
if the parameter is at the ends of the path or only covers part of the segment as in
&apos;/a{param?}/b&apos;). For example, the route &apos;/book/{id?}&apos; matches &apos;/book/&apos; with the value of
<code>request.params.id</code> set to an empty string <code>&apos;&apos;</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">getAlbum</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>You asked for <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span>
        (request.params.song <span class="pl-k">?</span> request.params.song <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&apos;</span> from <span class="pl-pds">&apos;</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span><span class="pl-pds">&apos;</span></span>) <span class="pl-k">+</span>
        request.params.album);
};

server.route({
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/{album}/{song?}<span class="pl-pds">&apos;</span></span>,
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    handler<span class="pl-k">:</span> getAlbum
});</pre></div>

<p>In addition to the optional <code>?</code> suffix, a parameter name can also specify the number of matching
segments using the <code>*</code> suffix, followed by a number greater than 1. If the number of expected parts
can be anything, then use <code>*</code> without a number (matching any number of segments can only be used in
the last path segment).</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">getPerson</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">nameParts</span> <span class="pl-k">=</span> request.params.<span class="pl-c1">name</span>.<span class="pl-c1">split</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>);
    <span class="pl-k">return</span> reply({ first<span class="pl-k">:</span> nameParts[<span class="pl-c1">0</span>], last<span class="pl-k">:</span> nameParts[<span class="pl-c1">1</span>] });
};

server.route({
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/person/{name*2}<span class="pl-pds">&apos;</span></span>,   <span class="pl-c">// Matches &apos;/person/john/doe&apos;</span>
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    handler<span class="pl-k">:</span> getPerson
});</pre></div>

<h3><a id="path-matching-order" class="anchor" href="#path-matching-order" aria-hidden="true"><span class="octicon octicon-link"></span></a>Path matching order</h3>

<p>The router iterates through the routing table on each incoming request and executes the first (and
only the first) matching route. Route matching is done based on the combination of the request path
and the HTTP verb (e.g. &apos;GET, &apos;POST&apos;). The query is excluded from the routing logic. Requests are
matched in a deterministic order where the order in which routes are added does not matter.</p>

<p>Routes are matched based on the specificity of the route which is evaluated at each segment of the
incoming request path. Each request path is split into its segment (the parts separated by <code>&apos;/&apos;</code>).
The segments are compared to the routing table one at a time and are matched against the most
specific path until a match is found. If no match is found, the next match is tried.</p>

<p>When matching routes, string literals (no path parameter) have the highest priority, followed by
mixed parameters (<code>&apos;/a{p}b&apos;</code>), parameters (<code>&apos;/{p}&apos;</code>), and then wildcard (<code>/{p*}</code>).</p>

<p>Note that mixed parameters are slower to compare as they cannot be hashed and require an array
iteration over all the regular expressions representing the various mixed parameter at each
routing table node.</p>

<h4><a id="catch-all-route" class="anchor" href="#catch-all-route" aria-hidden="true"><span class="octicon octicon-link"></span></a>Catch all route</h4>

<p>If the application needs to override the default Not Found (404) error response, it can add a
catch-all route for a specific method or all methods. Only one catch-all route can be defined per
server connection.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>The page was not found<span class="pl-pds">&apos;</span></span>).<span class="pl-c1">code</span>(<span class="pl-c1">404</span>);
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>*<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/{p*}<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> handler });</pre></div>

<h3><a id="route-handler" class="anchor" href="#route-handler" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route handler</h3>

<p>The route handler function uses the signature <code>function(request, reply)</code> where:</p>

<ul>
<li><code>request</code> - is the incoming <a href="#request-object" id="">request object</a> (this is not the node.js request
object).</li>
<li><code>reply</code> - the <a href="#reply-interface" id="">reply interface</a> the handler must call to set a response and
return control back to the framework.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>success<span class="pl-pds">&apos;</span></span>);
};</pre></div>

<h3><a id="route-prerequisites" class="anchor" href="#route-prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Route prerequisites</h3>

<p>It is often necessary to perform prerequisite actions before the handler is called (e.g. load
required reference data from a database). The route <code>pre</code> option allows defining such pre-handler
methods. The methods are called in order. If the <code>pre</code> array contains another array, those methods
are called in parallel. <code>pre</code> can be assigned a mixed array of:</p>

<ul>
<li>arrays containing the elements listed below, which are executed in parallel.</li>
<li>objects with:

<ul>
<li><code>method</code> - the function to call (or short-hand method string as described below). the
function signature is identical to a route handler as described in
<a href="#route-handler" id="">Route handler</a>.</li>
<li><code>assign</code> - key name to assign the result of the function to within <code>request.pre</code>.</li>
<li><code>failAction</code> - determines how to handle errors returned by the method. Allowed values are:

<ul>
<li><code>&apos;error&apos;</code> - returns the error response back to the client. This is the default value.</li>
<li><code>&apos;log&apos;</code> - logs the error but continues processing the request. If <code>assign</code> is used, the
error will be assigned.</li>
<li><code>&apos;ignore&apos;</code> - takes no special action. If <code>assign</code> is used, the error will be assigned.</li>
</ul></li>
</ul></li>
<li>functions - same as including an object with a single <code>method</code> key.</li>
<li>strings - special short-hand notation for registered
<a href="#servermethodname-method-options" id="">server methods</a> using the format &apos;name(args)&apos; (e.g.
<code>&apos;user(params.id)&apos;</code>) where:

<ul>
<li>&apos;name&apos; - the method name. The name is also used as the default value of <code>assign</code>.</li>
<li>&apos;args&apos; - the method arguments (excluding <code>next</code>) where each argument is a property of
the <a href="#request-object" id="">request object</a>.</li>
</ul></li>
</ul>

<p>Note that prerequisites do not follow the same rules of the normal
<a href="#reply-interface" id="">reply interface</a>. In all other cases, calling <code>reply()</code> with or without a value
will use the result as the response sent back to the client. In a prerequisite method, calling
<code>reply()</code> will assign the returned value to the provided <code>assign</code> key. If the returned value is an
error, the <code>failAction</code> setting determines the behavior. To force the return value as the response
and ends the request lifecycle, use the <code>reply().takeover()</code> method.</p>

<p>The reason for the difference in the reply interface behavior is to allow reusing handlers and
prerequisites methods interchangeably. By default, the desired behavior for a prerequisite is to
retain the result value and pass it on to the next step. Errors end the lifecycle by default. While
less consistent, this allows easier code reusability.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">pre1</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>Hello<span class="pl-pds">&apos;</span></span>);
};

<span class="pl-k">const</span> <span class="pl-c1">pre2</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>World<span class="pl-pds">&apos;</span></span>);
};

<span class="pl-k">const</span> <span class="pl-c1">pre3</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(request.pre.m1 <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&apos;</span> <span class="pl-pds">&apos;</span></span> <span class="pl-k">+</span> request.pre.m2);
};

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>,
    config<span class="pl-k">:</span> {
        pre<span class="pl-k">:</span> [
            [
                <span class="pl-c">// m1 and m2 executed in parallel</span>
                { method<span class="pl-k">:</span> pre1, assign<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>m1<span class="pl-pds">&apos;</span></span> },
                { method<span class="pl-k">:</span> pre2, assign<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>m2<span class="pl-pds">&apos;</span></span> }
            ],
            { method<span class="pl-k">:</span> pre3, assign<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>m3<span class="pl-pds">&apos;</span></span> },
        ],
        <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

            <span class="pl-k">return</span> reply(request.pre.m3 <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">&apos;</span><span class="pl-cce">\n</span><span class="pl-pds">&apos;</span></span>);
        }
    }
});</pre></div>

<h3><a id="request-object" class="anchor" href="#request-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request object</h3>

<p>The request object is created internally for each incoming request. It is <strong>different</strong> from the
node.js request object received from the HTTP server callback (which is available in
<code>request.raw.req</code>). The request object methods and properties change throughout the
<a href="#request-lifecycle" id="">request lifecycle</a>.</p>

<h4><a id="request-properties" class="anchor" href="#request-properties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request properties</h4>

<p>Each request object includes the following properties:</p>

<ul>
<li><code>app</code> - application-specific state. Provides a safe place to store application data without
potential conflicts with the framework. Should not be used by <a href="#plugins" id="">plugins</a> which should use
<code>plugins[name]</code>.</li>
<li><code>auth</code> - authentication information:

<ul>
<li><code>isAuthenticated</code> - <code>true</code> if the request has been successfully authenticated, otherwise
<code>false</code>.</li>
<li><code>credentials</code> - the <code>credential</code> object received during the authentication process. The
presence of an object does not mean successful authentication.</li>
<li><code>artifacts</code> - an artifact object received from the authentication strategy and used in
authentication-related actions.</li>
<li><code>mode</code> - the route authentication mode.</li>
<li><code>error</code> - the authentication error is failed and mode set to <code>&apos;try&apos;</code>.</li>
<li><code>session</code> - an object used by the
<a href="https://github.com/hapijs/hapi-auth-cookie" id=""><code>&apos;cookie&apos;</code> authentication scheme</a>.</li>
</ul></li>
<li><code>domain</code> - the node domain object used to protect against exceptions thrown in extensions,
handlers and <a href="#route-prerequisites" id="">route prerequisites</a>. Can be used to manually bind callback
functions otherwise bound to other domains. Set to <code>null</code> when the server <code>useDomains</code> options is
<code>false</code>.</li>
<li><code>headers</code> - the raw request headers (references <code>request.raw.headers</code>).</li>
<li><code>id</code> - a unique request identifier (using the format &apos;{now}:{connection.info.id}:{5 digits counter}&apos;).</li>
<li><code>info</code> - request information:

<ul>
<li><code>received</code> - request reception timestamp.</li>
<li><code>responded</code> - request response timestamp (<code>0</code> is not responded yet).</li>
<li><code>remoteAddress</code> - remote client IP address.</li>
<li><code>remotePort</code> - remote client port.</li>
<li><code>referrer</code> - content of the HTTP &apos;Referrer&apos; (or &apos;Referer&apos;) header.</li>
<li><code>host</code> - content of the HTTP &apos;Host&apos; header (e.g. &apos;example.com:8080&apos;).</li>
<li><code>hostname</code> - the hostname part of the &apos;Host&apos; header (e.g. &apos;example.com&apos;).</li>
</ul></li>
<li><code>method</code> - the request method in lower case (e.g. <code>&apos;get&apos;</code>, <code>&apos;post&apos;</code>).</li>
<li><code>mime</code> - the parsed content-type header. Only available when payload parsing enabled and no
payload error occurred.</li>
<li><code>orig</code> - an object containing the values of <code>params</code>, <code>query</code>, and <code>payload</code> before any
validation modifications made. Only set when input validation is performed.</li>
<li><code>params</code> - an object where each key is a path parameter name with matching value as described in
<a href="#path-parameters" id="">Path parameters</a>.</li>
<li><code>paramsArray</code> - an array containing all the path <code>params</code> values in the order they appeared in
the path.</li>
<li><code>path</code> - the request URI&apos;s path component.</li>
<li><code>payload</code> - the request payload based on the route <code>payload.output</code> and <code>payload.parse</code> settings.</li>
<li><code>plugins</code> - plugin-specific state. Provides a place to store and pass request-level plugin data.
The <code>plugins</code> is an object where each key is a plugin name and the value is the state.</li>
<li><code>pre</code> - an object where each key is the name assigned by a
<a href="#route-prerequisites" id="">route prerequisites</a> function. The values are the raw values provided to
the continuation function as argument. For the wrapped response object, use <code>responses</code>.</li>
<li><code>response</code> - the response object when set. The object can be modified but must not be assigned
another object. To replace the response with another from within an
<a href="#serverextevent-method-options" id="">extension point</a>, use <code>reply(response)</code> to override with a
different response. Contains <code>null</code> when no response has been set (e.g. when a request terminates
prematurely when the client disconnects).</li>
<li><code>preResponses</code> - same as <code>pre</code> but represented as the response object created by the pre method.</li>
<li><code>query</code> - an object containing the query parameters.</li>
<li><code>raw</code> - an object containing the Node HTTP server objects. <strong>Direct interaction with these raw
objects is not recommended.</strong>

<ul>
<li><code>req</code> - the node.js request object.</li>
<li><code>res</code> - the node.js response object.</li>
</ul></li>
<li><code>route</code> - the <a href="#route-public-interface" id="">route public interface</a>.</li>
<li><code>server</code> - the server object.</li>
<li><code>session</code> - Special key reserved for <a href="#plugins" id="">plugins</a> implementing session support. Plugins
utilizing this key must check for <code>null</code> value to ensure there is no conflict with another
similar server.</li>
<li><code>state</code> - an object containing parsed HTTP state information (cookies) where each key is the
cookie name and value is the matching cookie content after processing using any registered cookie
definition.</li>
<li><code>url</code> - the parsed request URI.</li>
</ul>

<h4><a id="requestseturlurl-striptrailingslash-parseroptions" class="anchor" href="#requestseturlurl-striptrailingslash-parseroptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>request.setUrl(url, [stripTrailingSlash], [parserOptions])</code></h4>

<p><em>Available only in <code>&apos;onRequest&apos;</code> extension methods.</em></p>

<p>Changes the request URI before the router begins processing the request where:</p>

<ul>
<li><code>url</code> - the new request path value.</li>
<li><code>stripTrailingSlash</code> - if <code>true</code>, strip the trailing slash from the path. Defaults to <code>false</code>.</li>
<li><code>parserOptions</code> - optional URI parsing <a href="https://www.npmjs.com/package/qs#parsing-objects" id="">options</a>.
Defaults to the route connection <code>query.qs</code> settings if present, otherwise the <strong>qs</strong> module
parsing defaults.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">onRequest</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-c">// Change all requests to &apos;/test&apos;</span>
    request.setUrl(<span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>);
    <span class="pl-k">return</span> reply.continue();
};

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onRequest<span class="pl-pds">&apos;</span></span>, onRequest);</pre></div>

<h4><a id="requestsetmethodmethod" class="anchor" href="#requestsetmethodmethod" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>request.setMethod(method)</code></h4>

<p><em>Available only in <code>&apos;onRequest&apos;</code> extension methods.</em></p>

<p>Changes the request method before the router begins processing the request where:</p>

<ul>
<li><code>method</code> - is the request HTTP method (e.g. <code>&apos;GET&apos;</code>).</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">onRequest</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-c">// Change all requests to &apos;GET&apos;</span>
    request.setMethod(<span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>);
    <span class="pl-k">return</span> reply.continue();
};

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onRequest<span class="pl-pds">&apos;</span></span>, onRequest);</pre></div>

<h4><a id="requestgenerateresponsesource-options" class="anchor" href="#requestgenerateresponsesource-options" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>request.generateResponse(source, [options])</code></h4>

<p><em>Always available.</em></p>

<p>Returns a <a href="#response-object" id=""><code>response</code></a> which you can pass into the <a href="#reply-interface" id="">reply interface</a> where:</p>

<ul>
<li><code>source</code> - the object to set as the source of the <a href="#reply-interface" id="">reply interface</a>.</li>
<li><code>options</code> - options for the method, optional.</li>
</ul>

<p>For example it can be used inside a promise to create a response object which has a non-error code to resolve with the <a href="#reply-interface" id="">reply interface</a>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">result</span> <span class="pl-k">=</span> promiseMethod().then((<span class="pl-smi">thing</span>)<span class="pl-k"> =&gt;</span> {

        <span class="pl-k">if</span> (<span class="pl-k">!</span>thing) {
            <span class="pl-k">return</span> request.generateResponse().<span class="pl-c1">code</span>(<span class="pl-c1">214</span>);
        }
        <span class="pl-k">return</span> thing;
    });
    <span class="pl-k">return</span> reply(result);
};</pre></div>

<h4><a id="requestlogtags-data-timestamp" class="anchor" href="#requestlogtags-data-timestamp" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>request.log(tags, [data, [timestamp]])</code></h4>

<p><em>Always available.</em></p>

<p>Logs request-specific events. When called, the server emits a <code>&apos;request&apos;</code> event which can be used
by other listeners or <a href="#plugins" id="">plugins</a>. The arguments are:</p>

<ul>
<li><code>tags</code> - a string or an array of strings (e.g. <code>[&apos;error&apos;, &apos;database&apos;, &apos;read&apos;]</code>) used to identify
the event. Tags are used instead of log levels and provide a much more expressive mechanism for
describing and filtering events.</li>
<li><code>data</code> - an optional message string or object with the application data being logged.</li>
<li><code>timestamp</code> - an optional timestamp expressed in milliseconds. Defaults to <code>Date.now()</code> (now).</li>
</ul>

<p>Any logs generated by the server internally will be emitted only on the <code>&apos;request-internal&apos;</code>
channel and will include the <code>event.internal</code> flag set to <code>true</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>request<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">request</span>, <span class="pl-smi">event</span>, <span class="pl-smi">tags</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-k">if</span> (tags.error) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-c1">event</span>);
    }
});

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    request.<span class="pl-c1">log</span>([<span class="pl-s"><span class="pl-pds">&apos;</span>test<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>error<span class="pl-pds">&apos;</span></span>], <span class="pl-s"><span class="pl-pds">&apos;</span>Test event<span class="pl-pds">&apos;</span></span>);
    <span class="pl-k">return</span> reply();
};</pre></div>

<h4><a id="requestgetlogtags-internal" class="anchor" href="#requestgetlogtags-internal" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>request.getLog([tags], [internal])</code></h4>

<p><em>Always available.</em></p>

<p>Returns an array containing the events matching any of the tags specified (logical OR) where:</p>

<ul>
<li><code>tags</code> - is a single tag string or array of tag strings. If no <code>tags</code> specified, returns all
events.</li>
<li><code>internal</code> - filters the events to only those with a matching <code>event.internal</code> value. If <code>true</code>,
only internal logs are included. If <code>false</code>, only user event are included. Defaults to all events
(<code>undefined</code>).</li>
</ul>

<div class="highlight highlight-source-js"><pre>request.getLog();
request.getLog(<span class="pl-s"><span class="pl-pds">&apos;</span>error<span class="pl-pds">&apos;</span></span>);
request.getLog([<span class="pl-s"><span class="pl-pds">&apos;</span>error<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>auth<span class="pl-pds">&apos;</span></span>]);
request.getLog([<span class="pl-s"><span class="pl-pds">&apos;</span>error<span class="pl-pds">&apos;</span></span>], <span class="pl-c1">true</span>);
request.getLog(<span class="pl-c1">false</span>);</pre></div>

<h4><a id="requesttailname" class="anchor" href="#requesttailname" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>request.tail([name])</code></h4>

<p><em>Available until immediately after the <code>&apos;response&apos;</code> event is emitted.</em></p>

<p>Adds a request tail which has to complete before the <a href="#request-lifecycle" id="">request lifecycle</a> is
complete where:</p>

<ul>
<li><code>name</code> - an optional tail name used for logging purposes.</li>
</ul>

<p>Returns a tail function which must be called when the tail activity is completed.</p>

<p>Tails are actions performed throughout the <a href="#request-lifecycle" id="">request lifecycle</a>, but which may
end after a response is sent back to the client. For example, a request may trigger a database
update which should not delay sending back a response. However, it is still desirable to associate
the activity with the request when logging it (or an error associated with it).</p>

<p>When all tails completed, the server emits a <code>&apos;tail&apos;</code> event.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">get</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">dbTail</span> <span class="pl-k">=</span> request.tail(<span class="pl-s"><span class="pl-pds">&apos;</span>write to database<span class="pl-pds">&apos;</span></span>);

    db.save(<span class="pl-s"><span class="pl-pds">&apos;</span>key<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>value<span class="pl-pds">&apos;</span></span>, ()<span class="pl-k"> =&gt;</span> {

        dbTail();
    });

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>Success!<span class="pl-pds">&apos;</span></span>);
};

server.route({ method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>, path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/<span class="pl-pds">&apos;</span></span>, handler<span class="pl-k">:</span> get });

server.on(<span class="pl-s"><span class="pl-pds">&apos;</span>tail<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">request</span>)<span class="pl-k"> =&gt;</span> {

    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>Request completed including db activity<span class="pl-pds">&apos;</span></span>);
});</pre></div>

<h4><a id="request-events" class="anchor" href="#request-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request events</h4>

<p>The <a href="#request-object" id="">request object</a> supports the following events:</p>

<ul>
<li><code>&apos;peek&apos;</code> - emitted for each chunk of payload data read from the client connection. The event
method signature is <code>function(chunk, encoding)</code>.</li>
<li><code>&apos;finish&apos;</code> - emitted when the request payload finished reading. The event method signature is
<code>function ()</code>.</li>
<li><code>&apos;disconnect&apos;</code> - emitted when a request errors or aborts unexpectedly.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Crypto</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>crypto<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">onRequest</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">hash</span> <span class="pl-k">=</span> Crypto.createHash(<span class="pl-s"><span class="pl-pds">&apos;</span>sha1<span class="pl-pds">&apos;</span></span>);
    request.on(<span class="pl-s"><span class="pl-pds">&apos;</span>peek<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">chunk</span>)<span class="pl-k"> =&gt;</span> {

        hash.update(chunk);
    });

    request.once(<span class="pl-s"><span class="pl-pds">&apos;</span>finish<span class="pl-pds">&apos;</span></span>, ()<span class="pl-k"> =&gt;</span> {

        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(hash.digest(<span class="pl-s"><span class="pl-pds">&apos;</span>hex<span class="pl-pds">&apos;</span></span>));
    });

    request.once(<span class="pl-s"><span class="pl-pds">&apos;</span>disconnect<span class="pl-pds">&apos;</span></span>, ()<span class="pl-k"> =&gt;</span> {

        <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>request aborted<span class="pl-pds">&apos;</span></span>);
    });

    <span class="pl-k">return</span> reply.continue();
};

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onRequest<span class="pl-pds">&apos;</span></span>, onRequest);</pre></div>

<h2><a id="reply-interface" class="anchor" href="#reply-interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reply interface</h2>

<p>The various <a href="#request-lifecycle" id="">request lifecycle</a> events (e.g. extensions, authentication,
<a href="#route-prerequisites" id="">route prerequisites</a>, handlers) provide a reply interface as one of the
function arguments. The reply interface acts as both a callback interface to return control to the
framework and a response generator.</p>

<p>When <code>reply()</code> is called with an error or result response, that value is used as the response sent
to the client. When <code>reply()</code> is called within a prerequisite, the value is saved for future use
and is not used as the response. In all other places except for the handler, calling <code>reply()</code> will
be considered an error and will abort the <a href="#request-lifecycle" id="">request lifecycle</a>, jumping directly
to the <code>&apos;onPreResponse&apos;</code> event.</p>

<p>To return control to the framework within an <a href="#serverextevent-method-options" id="">extension</a> or other
places other than the handler, without setting a response, the method
<a href="#replycontinuedata" id=""><code>reply.continue()</code></a> must be called.</p>

<h3><a id="replyerr-result" class="anchor" href="#replyerr-result" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>reply([err], [result])</code></h3>

<p>Concludes the handler activity by setting a response and returning control over to the framework
where:</p>

<ul>
<li><code>err</code> - an optional error response.</li>
<li><code>result</code> - an optional response payload.</li>
</ul>

<p>Since an request can only have one response regardless if it is an error or success, the <code>reply()</code>
method can only result in a single response value. This means that passing both an <code>err</code> and
<code>result</code> will only use the <code>err</code>. There is no requirement for either <code>err</code> or <code>result</code> to be (or
not) an <code>Error</code> object. The framework will simply use the first argument if present, otherwise the
second. The method supports two arguments to be compatible with the common callback pattern of
error first.</p>

<p>Both <code>err</code> and <code>result</code> can be set to:</p>

<ul>
<li><code>null</code></li>
<li><code>undefined</code></li>
<li>string</li>
<li>number</li>
<li>boolean</li>
<li><code>Buffer</code> object</li>
<li><code>Error</code> object</li>
<li><code>Stream</code> object (<strong>Note</strong> - any <code>Stream</code> object must be compatible with the &quot;streams2&quot; API and not be in <code>objectMode</code>)</li>
<li>Promise object</li>
<li>any other object or array</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>success<span class="pl-pds">&apos;</span></span>);
};</pre></div>

<p>If the input is not an <code>Error</code> object, the method returns a <a href="#response-object" id=""><code>response</code></a> object
which provides a set of methods to customize the response (e.g. HTTP status code, custom headers,
etc.). If the input is an <code>Error</code> object, the method returns back the error wrapped in a
<a href="https://github.com/hapijs/boom" id=""><code>Boom</code></a> object.</p>

<p>Note that when used to return both an error and credentials in the authentication methods,
<code>reply()</code> must be called with three arguments <code>function(err, null, data)</code> where <code>data</code> is the
additional authentication information.</p>

<p>The <a href="#flow-control" id="">response flow control rules</a> apply.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// Detailed notation</span>

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">response</span> <span class="pl-k">=</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>success<span class="pl-pds">&apos;</span></span>);
    response.<span class="pl-c1">type</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>text/plain<span class="pl-pds">&apos;</span></span>);
    response.header(<span class="pl-s"><span class="pl-pds">&apos;</span>X-Custom<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>some-value<span class="pl-pds">&apos;</span></span>);
};

<span class="pl-c">// Chained notation</span>

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>success<span class="pl-pds">&apos;</span></span>)
        .<span class="pl-c1">type</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>text/plain<span class="pl-pds">&apos;</span></span>)
        .header(<span class="pl-s"><span class="pl-pds">&apos;</span>X-Custom<span class="pl-pds">&apos;</span></span>, <span class="pl-s"><span class="pl-pds">&apos;</span>some-value<span class="pl-pds">&apos;</span></span>);
};</pre></div>

<p>Note that if <code>result</code> is a <code>Stream</code> with a <code>statusCode</code> property, that status code will be used as
the default response code.</p>

<p>Any value provided to <code>reply()</code> (including no value) will be used as the response sent back to the
client. This means calling <code>reply()</code> with a value in an
<a href="#serverextevent-method-options" id="">extension methods</a> or authentication function will be considered
an error and will terminate the <a href="#request-lifecycle" id="">request lifecycle</a>. With the exception of the
handler function, all other methods provide the <code>reply.continue()</code> method which instructs the
framework to continue processing the request without setting a response.</p>

<h4><a id="response-object" class="anchor" href="#response-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Response object</h4>

<p>Every response includes the following properties:</p>

<ul>
<li><code>statusCode</code> - the HTTP response status code. Defaults to <code>200</code> (except for errors).</li>
<li><code>headers</code> - an object containing the response headers where each key is a header field name. Note
that this is an incomplete list of headers to be included with the response. Additional headers
will be added once the response is prepare for transmission.</li>
<li><code>source</code> - the value provided using the <a href="#reply-interface" id="">reply interface</a>.</li>
<li><code>variety</code> - a string indicating the type of <code>source</code> with available values:

<ul>
<li><code>&apos;plain&apos;</code> - a plain response such as string, number, <code>null</code>, or simple object (e.g. not a
<code>Stream</code>, <code>Buffer</code>, or view).</li>
<li><code>&apos;buffer&apos;</code> - a <code>Buffer</code>.</li>
<li><code>&apos;stream&apos;</code> - a <code>Stream</code>.</li>
<li><code>&apos;promise&apos;</code> - a Promise object.</li>
</ul></li>
<li><code>app</code> - application-specific state. Provides a safe place to store application data without
potential conflicts with the framework. Should not be used by <a href="#plugins" id="">plugins</a> which should
use <code>plugins[name]</code>.</li>
<li><code>plugins</code> - plugin-specific state. Provides a place to store and pass request-level plugin data.
The <code>plugins</code> is an object where each key is a plugin name and the value is the state.</li>
<li><code>settings</code> - response handling flags:

<ul>
<li><code>charset</code> -  the &apos;Content-Type&apos; HTTP header &apos;charset&apos; property. Defaults to <code>&apos;utf-8&apos;</code>.</li>
<li><code>encoding</code> - the string encoding scheme used to serial data into the HTTP payload when
<code>source</code> is a string or marshals into a string.
Defaults to <code>&apos;utf8&apos;</code>.</li>
<li><code>passThrough</code> - if <code>true</code> and <code>source</code> is a <code>Stream</code>, copies the <code>statusCode</code> and <code>headers</code>
of the stream to the outbound response. Defaults to <code>true</code>.</li>
<li><code>stringify</code> - options used for <code>source</code> value requiring stringification. Defaults to no
replacer and no space padding.</li>
<li><code>ttl</code> -  if set, overrides the route cache expiration milliseconds value set in the route
config. Defaults to no override.</li>
<li><code>varyEtag</code> - if <code>true</code>, a suffix will be automatically added to the &apos;ETag&apos; header at
transmission time (separated by a <code>&apos;-&apos;</code> character) when the HTTP &apos;Vary&apos; header is present.</li>
</ul></li>
</ul>

<p>The response object provides the following methods:</p>

<ul>
<li><code>bytes(length)</code> - sets the HTTP &apos;Content-Length&apos; header (to avoid chunked transfer encoding)
where:

<ul>
<li><code>length</code> - the header value. Must match the actual payload size.</li>
</ul></li>
<li><code>charset(charset)</code> - sets the &apos;Content-Type&apos; HTTP header &apos;charset&apos; property where:
<code>charset</code> - the charset property value.</li>
<li><code>code(statusCode)</code> - sets the HTTP status code where:

<ul>
<li><code>statusCode</code> - the HTTP status code.</li>
</ul></li>
<li><code>created(uri)</code> - sets the HTTP status code to Created (201) and the HTTP &apos;Location&apos; header where:
<code>uri</code> - an absolute or relative URI used as the &apos;Location&apos; header value.</li>
<li><code>encoding(encoding)</code> - sets the string encoding scheme used to serial data into the HTTP payload
where:
  <code>encoding</code> - the encoding property value (see
    <a href="http://nodejs.org/api/buffer.html#buffer_buffer" id="">node Buffer encoding</a>).</li>
<li><code>etag(tag, options)</code> - sets the representation
<a href="http://tools.ietf.org/html/rfc7232#section-2.3" id="">entity tag</a> where:

<ul>
<li><code>tag</code> - the entity tag string without the double-quote.</li>
<li><code>options</code> - optional settings where:

<ul>
<li><code>weak</code> - if <code>true</code>, the tag will be prefixed with the <code>&apos;W/&apos;</code> weak signifier. Weak tags
will fail to match identical tags for the purpose of determining 304 response status.
Defaults to <code>false</code>.</li>
<li><code>vary</code> - if <code>true</code> and content encoding is set or applied to the response (e.g &apos;gzip&apos; or
&apos;deflate&apos;), the encoding name will be automatically added to the tag at transmission time
(separated by a <code>&apos;-&apos;</code> character). Ignored when <code>weak</code> is <code>true</code>. Defaults to <code>true</code>.</li>
</ul></li>
</ul></li>
<li><code>header(name, value, options)</code> - sets an HTTP header where:

<ul>
<li><code>name</code> - the header name.</li>
<li><code>value</code> - the header value.</li>
<li><code>options</code> - optional settings where:

<ul>
<li><code>append</code> - if <code>true</code>, the value is appended to any existing header value using
<code>separator</code>. Defaults to <code>false</code>.</li>
<li><code>separator</code> - string used as separator when appending to an exiting value. Defaults to
<code>&apos;,&apos;</code>.</li>
<li><code>override</code> - if <code>false</code>, the header value is not set if an existing value present.
Defaults to <code>true</code>.</li>
<li><code>duplicate</code> - if <code>false</code>, the header value is not modified if the provided value is
already included. Does not apply when <code>append</code> is <code>false</code> or if the <code>name</code> is
<code>&apos;set-cookie&apos;</code>. Defaults to <code>true</code>.</li>
</ul></li>
</ul></li>
<li><code>location(uri)</code> - sets the HTTP &apos;Location&apos; header where:

<ul>
<li><code>uri</code> - an absolute or relative URI used as the &apos;Location&apos; header value.</li>
</ul></li>
<li><code>redirect(uri)</code> - sets an HTTP redirection response (302) and decorates the response with
additional methods listed below, where:

<ul>
<li><code>uri</code> - an absolute or relative URI used to redirect the client to another resource.</li>
</ul></li>
<li><code>replacer(method)</code> - sets the <code>JSON.stringify()</code> <code>replacer</code> argument where:

<ul>
<li><code>method</code> - the replacer function or array. Defaults to none.</li>
</ul></li>
<li><code>spaces(count)</code> - sets the <code>JSON.stringify()</code> <code>space</code> argument where:

<ul>
<li><code>count</code> - the number of spaces to indent nested object keys. Defaults to no indentation.</li>
</ul></li>
<li><code>state(name, value, [options])</code> - sets an HTTP cookie where:

<ul>
<li><code>name</code> - the cookie name.</li>
<li><code>value</code> - the cookie value. If no <code>encoding</code> is defined, must be a string.</li>
<li><code>options</code> - optional configuration. If the state was previously registered with the server
using <a href="#serverstatename-options" id=""><code>server.state()</code></a>,
the specified keys in <code>options</code> override those same keys in the server definition (but not
others).</li>
</ul></li>
<li><code>suffix(suffix)</code> - sets a string suffix when the response is process via <code>JSON.stringify()</code>.</li>
<li><code>ttl(msec)</code> - overrides the default route cache expiration rule for this response instance where:

<ul>
<li><code>msec</code> - the time-to-live value in milliseconds.</li>
</ul></li>
<li><code>type(mimeType)</code> - sets the HTTP &apos;Content-Type&apos; header where:

<ul>
<li><code>value</code> - is the mime type. Should only be used to override the built-in default for each
response type.</li>
</ul></li>
<li><code>unstate(name, [options])</code> - clears the HTTP cookie by setting an expired value where:

<ul>
<li><code>name</code> - the cookie name.</li>
<li><code>options</code> - optional configuration for expiring cookie. If the state was previously
registered with the server using <a href="#serverstatename-options" id=""><code>server.state()</code></a>, the specified
keys in <code>options</code> override those same keys in the server definition (but not others).</li>
</ul></li>
<li><code>vary(header)</code> - adds the provided header to the list of inputs affected the response generation
via the HTTP &apos;Vary&apos; header where:

<ul>
<li><code>header</code> - the HTTP request header name.</li>
</ul></li>
</ul>

<h5><a id="response-object-redirect-methods" class="anchor" href="#response-object-redirect-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Response Object Redirect Methods</h5>

<p>When using the <code>redirect()</code> method, the response object provides these additional methods:</p>

<ul>
<li><code>temporary(isTemporary)</code> - sets the status code to <code>302</code> or <code>307</code> (based on the <code>rewritable()</code>
setting) where:

<ul>
<li><code>isTemporary</code> - if <code>false</code>, sets status to permanent. Defaults to <code>true</code>.</li>
</ul></li>
<li><code>permanent(isPermanent)</code> - sets the status code to <code>301</code> or <code>308</code> (based on the <code>rewritable()</code>
setting) where:

<ul>
<li><code>isPermanent</code> - if <code>false</code>, sets status to temporary. Defaults to <code>true</code>.</li>
</ul></li>
<li><code>rewritable(isRewritable)</code> - sets the status code to <code>301</code>/<code>302</code> for rewritable (allows changing
the request method from &apos;POST&apos; to &apos;GET&apos;) or <code>307</code>/<code>308</code> for non-rewritable (does not allow
changing the request method from &apos;POST&apos; to &apos;GET&apos;). Exact code based on the <code>temporary()</code> or
<code>permanent()</code> setting. Arguments:

<ul>
<li><code>isRewritable</code> - if <code>false</code>, sets to non-rewritable. Defaults to <code>true</code>.</li>
</ul></li>
</ul>

<table><thead>
<tr>
<th></th>
<th>Permanent</th>
<th>Temporary</th>
</tr>
</thead><tbody>
<tr>
<td>Rewritable</td>
<td>301</td>
<td><strong>302</strong>(1)</td>
</tr>
<tr>
<td>Non-rewritable</td>
<td>308(2)</td>
<td>307</td>
</tr>
</tbody></table>

<p>Notes:
1. Default value.
2. <a href="http://tools.ietf.org/id/draft-reschke-http-status-308-07.txt" id="">Proposed code</a>, not supported by
  all clients.</p>

<h5><a id="response-events" class="anchor" href="#response-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Response events</h5>

<p>The response object supports the following events:</p>

<ul>
<li><code>&apos;peek&apos;</code> - emitted for each chunk of data written back to the client connection. The event method
signature is <code>function(chunk, encoding)</code>.</li>
<li><code>&apos;finish&apos;</code> - emitted when the response finished writing but before the client response connection
is ended. The event method signature is <code>function ()</code>.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Crypto</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>crypto<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">preResponse</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">response</span> <span class="pl-k">=</span> request.response;
    <span class="pl-k">if</span> (response.isBoom) {
        <span class="pl-k">return</span> reply();
    }

    <span class="pl-k">const</span> <span class="pl-c1">hash</span> <span class="pl-k">=</span> Crypto.createHash(<span class="pl-s"><span class="pl-pds">&apos;</span>sha1<span class="pl-pds">&apos;</span></span>);
    response.on(<span class="pl-s"><span class="pl-pds">&apos;</span>peek<span class="pl-pds">&apos;</span></span>, (<span class="pl-smi">chunk</span>)<span class="pl-k"> =&gt;</span> {

        hash.update(chunk);
    });

    response.once(<span class="pl-s"><span class="pl-pds">&apos;</span>finish<span class="pl-pds">&apos;</span></span>, ()<span class="pl-k"> =&gt;</span> {

        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(hash.digest(<span class="pl-s"><span class="pl-pds">&apos;</span>hex<span class="pl-pds">&apos;</span></span>));
    });

    <span class="pl-k">return</span> reply.continue();
};

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onPreResponse<span class="pl-pds">&apos;</span></span>, preResponse);</pre></div>

<h4><a id="error-response" class="anchor" href="#error-response" aria-hidden="true"><span class="octicon octicon-link"></span></a>Error response</h4>

<p><strong>hapi</strong> uses the <a href="https://github.com/hapijs/boom" id=""><strong>boom</strong></a> error library for all its internal
error generation. <strong>boom</strong> provides an expressive interface to return HTTP errors. Any error
returned via the <a href="#reply-interface" id="">reply interface</a> is converted to a <strong>boom</strong> object and defaults
to status code <code>500</code> if the error is not a <strong>boom</strong> object.</p>

<p>When the error is sent back to the client, the responses contains a JSON object with the
<code>statusCode</code>, <code>error</code>, and <code>message</code> keys.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">Boom</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>boom<span class="pl-pds">&apos;</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/badRequest<span class="pl-pds">&apos;</span></span>,
    <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply(Boom.badRequest(<span class="pl-s"><span class="pl-pds">&apos;</span>Unsupported parameter<span class="pl-pds">&apos;</span></span>));
    }
});

server.route({
    method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>GET<span class="pl-pds">&apos;</span></span>,
    path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>/internal<span class="pl-pds">&apos;</span></span>,
    <span class="pl-en">handler</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

        <span class="pl-k">return</span> reply(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>unexpect error<span class="pl-pds">&apos;</span></span>));
    }
});</pre></div>

<h5><a id="error-transformation" class="anchor" href="#error-transformation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Error transformation</h5>

<p>Errors can be customized by changing their <code>output</code> content. The <strong>boom</strong> error object includes the
following properties:</p>

<ul>
<li><code>isBoom</code> - if <code>true</code>, indicates this is a <code>Boom</code> object instance.</li>
<li><code>message</code> - the error message.</li>
<li><code>output</code> - the formatted response. Can be directly manipulated after object construction to
return a custom error response. Allowed root keys:

<ul>
<li><code>statusCode</code> - the HTTP status code (typically 4xx or 5xx).</li>
<li><code>headers</code> - an object containing any HTTP headers where each key is a header name and value
is the header content.</li>
<li><code>payload</code> - the formatted object used as the response payload (stringified). Can be directly
manipulated but any changes will be lost
if <code>reformat()</code> is called. Any content allowed and by default includes the following content:

<ul>
<li><code>statusCode</code> - the HTTP status code, derived from <code>error.output.statusCode</code>.</li>
<li><code>error</code> - the HTTP status message (e.g. &apos;Bad Request&apos;, &apos;Internal Server Error&apos;) derived
from <code>statusCode</code>.</li>
<li><code>message</code> - the error message derived from <code>error.message</code>.</li>
</ul></li>
</ul></li>
<li>inherited <code>Error</code> properties.</li>
</ul>

<p>It also supports the following method:</p>

<ul>
<li><code>reformat()</code> - rebuilds <code>error.output</code> using the other object properties.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Boom</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>boom<span class="pl-pds">&apos;</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">error</span> <span class="pl-k">=</span> Boom.badRequest(<span class="pl-s"><span class="pl-pds">&apos;</span>Cannot feed after midnight<span class="pl-pds">&apos;</span></span>);
    error.output.statusCode <span class="pl-k">=</span> <span class="pl-c1">499</span>;    <span class="pl-c">// Assign a custom error code</span>
    error.reformat();

    error.output.payload.custom <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&apos;</span>abc_123<span class="pl-pds">&apos;</span></span>; <span class="pl-c">// Add custom key</span>

    <span class="pl-k">return</span> reply(error);
});</pre></div>

<p>When a different error representation is desired, such as an HTML page or a different payload
format, the <code>&apos;onPreResponse&apos;</code> extension point may be used to identify errors and replace them with
a different response object.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">Vision</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>vision<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.register(Vision, (<span class="pl-smi">err</span>)<span class="pl-k"> =&gt;</span> {
    server.views({
        engines<span class="pl-k">:</span> {
            html<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>handlebars<span class="pl-pds">&apos;</span></span>)
        }
  });
});
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">preResponse</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">response</span> <span class="pl-k">=</span> request.response;
    <span class="pl-k">if</span> (<span class="pl-k">!</span>response.isBoom) {
        <span class="pl-k">return</span> reply.continue();
    }

    <span class="pl-c">// Replace error with friendly HTML</span>

      <span class="pl-k">const</span> <span class="pl-c1">error</span> <span class="pl-k">=</span> response;
      <span class="pl-k">const</span> <span class="pl-c1">ctx</span> <span class="pl-k">=</span> {
          message<span class="pl-k">:</span> (error.output.statusCode <span class="pl-k">===</span> <span class="pl-c1">404</span> <span class="pl-k">?</span> <span class="pl-s"><span class="pl-pds">&apos;</span>page not found<span class="pl-pds">&apos;</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">&apos;</span>something went wrong<span class="pl-pds">&apos;</span></span>)
      };

      <span class="pl-k">return</span> reply.view(<span class="pl-s"><span class="pl-pds">&apos;</span>error<span class="pl-pds">&apos;</span></span>, ctx);
};

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onPreResponse<span class="pl-pds">&apos;</span></span>, preResponse);</pre></div>

<h4><a id="flow-control" class="anchor" href="#flow-control" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flow control</h4>

<p>When calling <code>reply()</code>, the framework waits until <code>process.nextTick()</code> to continue processing the
request and transmit the response. This enables making changes to the returned
<a href="#response-object" id="">response object</a> before the response is sent. This means the framework
will resume as soon as the handler method exits. To suspend this behavior, the returned
<code>response</code> object supports the following methods:</p>

<ul>
<li><code>hold()</code> - puts the response on hold until <code>response.send()</code> is called. Available only after
<code>reply()</code> is called and until <code>response.hold()</code> is invoked once.</li>
<li><code>send()</code> - resume the response which will be transmitted in the next tick. Available only after
<code>response.hold()</code> is called and until <code>response.send()</code> is invoked once.</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">const</span> <span class="pl-c1">response</span> <span class="pl-k">=</span> reply(<span class="pl-s"><span class="pl-pds">&apos;</span>success<span class="pl-pds">&apos;</span></span>).hold();

    <span class="pl-c1">setTimeout</span>(()<span class="pl-k"> =&gt;</span> {

        response.<span class="pl-c1">send</span>();
    }, <span class="pl-c1">1000</span>);
};</pre></div>

<h3><a id="replycontinuedata" class="anchor" href="#replycontinuedata" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>reply.continue([data])</code></h3>

<p>Returns control back to the framework without setting a response. If called in the handler, the
response defaults to an empty payload with status code <code>200</code>. The <code>data</code> argument is only used for
passing back authentication data and is ignored elsewhere.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">Hapi</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">&apos;</span>hapi<span class="pl-pds">&apos;</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Hapi.Server</span>();
server.connection({ port<span class="pl-k">:</span> <span class="pl-c1">80</span> });

<span class="pl-k">const</span> <span class="pl-c1">onRequest</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-c">// Change all requests to &apos;/test&apos;</span>
    request.setUrl(<span class="pl-s"><span class="pl-pds">&apos;</span>/test<span class="pl-pds">&apos;</span></span>);
    <span class="pl-k">return</span> reply.continue();
};

server.ext(<span class="pl-s"><span class="pl-pds">&apos;</span>onRequest<span class="pl-pds">&apos;</span></span>, onRequest);</pre></div>

<h3><a id="replycloseoptions" class="anchor" href="#replycloseoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>reply.close([options])</code></h3>

<p>Concludes the handler activity by returning control over to the router and informing the router
that a response has already been sent back directly via <code>request.raw.res</code> and that no further
response action is needed. Supports the following optional options:</p>

<ul>
<li><code>end</code> - if <code>false</code>, the router will not call <code>request.raw.res.end())</code> to ensure the response was
ended. Defaults to <code>true</code>.</li>
</ul>

<p>No return value.</p>

<p>The <a href="#flow-control" id="">response flow control rules</a> <strong>do not</strong> apply.</p>

<h3><a id="replyredirecturi" class="anchor" href="#replyredirecturi" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>reply.redirect(uri)</code></h3>

<p>Redirects the client to the specified uri. Same as calling <code>reply().redirect(uri)</code>.</p>

<p>Returns a <a href="#response-object" id="">response object</a>.</p>

<p>The <a href="#flow-control" id="">response flow control rules</a> apply.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">request</span>, <span class="pl-smi">reply</span>) {

    <span class="pl-k">return</span> reply.redirect(<span class="pl-s"><span class="pl-pds">&apos;</span>http://example.com<span class="pl-pds">&apos;</span></span>);
};</pre></div>

<p>Changing to a permanent or non-rewritable redirect is also available see
<a href="#response-object-redirect" id="">response object redirect</a> for more information.</p>
</article></div></div></div><div class="column nav-secondary" style="position: fixed; top: 0px; left: 818.4px; width: 297.6px;"><div class="search"><span>Search :</span><input id="searchText" placeholder="Type in a few words" class="search-input"></div><div class="tag-list cf"><p class="pull-left">Reference version:</p><div class="tag-list-toggle pull-right">11.1.0<ul class="unstyled tag-list-picker"><li><a href="/api/11.0.5">11.0.5</a></li><li><a href="/api/11.0.4">11.0.4</a></li><li><a href="/api/11.0.3">11.0.3</a></li><li><a href="/api/11.0.2">11.0.2</a></li><li><a href="/api/11.0.1">11.0.1</a></li><li><a href="/api/11.0.0">11.0.0</a></li><li><a href="/api/10.5.0">10.5.0</a></li><li><a href="/api/10.4.1">10.4.1</a></li><li><a href="/api/10.4.0">10.4.0</a></li><li><a href="/api/10.2.1">10.2.1</a></li><li><a href="/api/10.1.0">10.1.0</a></li><li><a href="/api/10.0.1">10.0.1</a></li><li><a href="/api/10.0.0">10.0.0</a></li><li><a href="/api/9.3.1">9.3.1</a></li><li><a href="/api/9.3.0">9.3.0</a></li><li><a href="/api/9.2.0">9.2.0</a></li><li><a href="/api/9.1.0">9.1.0</a></li><li><a href="/api/9.0.4">9.0.4</a></li><li><a href="/api/9.0.3">9.0.3</a></li><li><a href="/api/9.0.2">9.0.2</a></li><li><a href="/api/9.0.1">9.0.1</a></li><li><a href="/api/9.0.0">9.0.0</a></li><li><a href="/api/8.8.1">8.8.1</a></li><li><a href="/api/8.8.0">8.8.0</a></li><li><a href="/api/8.6.1">8.6.1</a></li><li><a href="/api/8.6.0">8.6.0</a></li><li><a href="/api/8.5.3">8.5.3</a></li><li><a href="/api/8.5.2">8.5.2</a></li><li><a href="/api/8.5.1">8.5.1</a></li><li><a href="/api/8.5.0">8.5.0</a></li><li><a href="/api/8.4.0">8.4.0</a></li><li><a href="/api/8.3.1">8.3.1</a></li><li><a href="/api/8.3.0">8.3.0</a></li><li><a href="/api/8.2.0">8.2.0</a></li><li><a href="/api/8.1.0">8.1.0</a></li><li><a href="/api/7.5.3">7.5.3</a></li><li><a href="/api/8.0.0">8.0.0</a></li><li><a href="/api/7.5.2">7.5.2</a></li><li><a href="/api/7.5.1">7.5.1</a></li><li><a href="/api/7.5.0">7.5.0</a></li><li><a href="/api/7.4.0">7.4.0</a></li><li><a href="/api/7.3.0">7.3.0</a></li><li><a href="/api/7.2.0">7.2.0</a></li><li><a href="/api/7.1.1">7.1.1</a></li><li><a href="/api/7.1.0">7.1.0</a></li><li><a href="/api/7.0.1">7.0.1</a></li><li><a href="/api/7.0.0">7.0.0</a></li><li><a href="/api/6.11.1">6.11.1</a></li><li><a href="/api/6.11.0">6.11.0</a></li><li><a href="/api/6.10.0">6.10.0</a></li><li><a href="/api/6.9.0">6.9.0</a></li><li><a href="/api/6.8.1">6.8.1</a></li><li><a href="/api/6.8.0">6.8.0</a></li><li><a href="/api/6.7.1">6.7.1</a></li><li><a href="/api/6.7.0">6.7.0</a></li><li><a href="/api/6.6.0">6.6.0</a></li><li><a href="/api/6.5.1">6.5.1</a></li><li><a href="/api/6.5.0">6.5.0</a></li><li><a href="/api/6.4.0">6.4.0</a></li><li><a href="/api/6.3.0">6.3.0</a></li><li><a href="/api/6.2.2">6.2.2</a></li><li><a href="/api/6.2.1">6.2.1</a></li><li><a href="/api/6.2.0">6.2.0</a></li><li><a href="/api/6.1.0">6.1.0</a></li><li><a href="/api/6.0.2">6.0.2</a></li><li><a href="/api/6.0.1">6.0.1</a></li><li><a href="/api/6.0.0">6.0.0</a></li><li><a href="/api/5.1.0">5.1.0</a></li><li><a href="/api/5.0.0">5.0.0</a></li><li><a href="/api/4.1.4">4.1.4</a></li><li><a href="/api/4.1.3">4.1.3</a></li><li><a href="/api/4.1.2">4.1.2</a></li><li><a href="/api/4.1.1">4.1.1</a></li><li><a href="/api/4.1.0">4.1.0</a></li><li><a href="/api/4.0.3">4.0.3</a></li><li><a href="/api/4.0.2">4.0.2</a></li><li><a href="/api/4.0.1">4.0.1</a></li><li><a href="/api/4.0.0">4.0.0</a></li><li><a href="/api/3.1.0">3.1.0</a></li><li><a href="/api/3.0.2">3.0.2</a></li><li><a href="/api/3.0.1">3.0.1</a></li><li><a href="/api/3.0.0">3.0.0</a></li><li><a href="/api/2.6.0">2.6.0</a></li><li><a href="/api/2.5.0">2.5.0</a></li><li><a href="/api/2.4.0">2.4.0</a></li><li><a href="/api/2.3.0">2.3.0</a></li><li><a href="/api/2.2.0">2.2.0</a></li><li><a href="/api/2.1.2">2.1.2</a></li><li><a href="/api/2.1.1">2.1.1</a></li><li><a href="/api/2.1.0">2.1.0</a></li><li><a href="/api/2.0.0">2.0.0</a></li><li><a href="/api/0.5.1-c">0.5.1-c</a></li><li><a href="/api/0.5.1-b2">0.5.1-b2</a></li><li><a href="/api/0.5.1-b">0.5.1-b</a></li><li><a href="/api/0.5.1-a">0.5.1-a</a></li><li><a href="/api/2.0.0-preview">2.0.0-preview</a></li><li><a href="/api/1.20.0">1.20.0</a></li><li><a href="/api/1.19.5">1.19.5</a></li><li><a href="/api/1.19.4">1.19.4</a></li><li><a href="/api/1.19.3">1.19.3</a></li><li><a href="/api/1.19.2">1.19.2</a></li><li><a href="/api/1.19.1">1.19.1</a></li><li><a href="/api/1.19.0">1.19.0</a></li><li><a href="/api/1.18.0">1.18.0</a></li><li><a href="/api/1.17.0">1.17.0</a></li><li><a href="/api/1.16.1">1.16.1</a></li><li><a href="/api/1.16.0">1.16.0</a></li><li><a href="/api/1.15.0">1.15.0</a></li><li><a href="/api/1.14.0">1.14.0</a></li><li><a href="/api/1.13.0">1.13.0</a></li><li><a href="/api/1.12.0">1.12.0</a></li><li><a href="/api/1.11.1">1.11.1</a></li><li><a href="/api/1.11.0">1.11.0</a></li><li><a href="/api/1.10.0">1.10.0</a></li><li><a href="/api/1.9.7">1.9.7</a></li><li><a href="/api/1.9.6">1.9.6</a></li><li><a href="/api/1.9.5">1.9.5</a></li><li><a href="/api/1.9.4">1.9.4</a></li><li><a href="/api/1.9.3">1.9.3</a></li><li><a href="/api/1.9.2">1.9.2</a></li><li><a href="/api/1.9.1">1.9.1</a></li><li><a href="/api/1.9.0">1.9.0</a></li><li><a href="/api/1.8.3">1.8.3</a></li><li><a href="/api/1.8.2">1.8.2</a></li><li><a href="/api/1.8.1">1.8.1</a></li><li><a href="/api/1.8.0">1.8.0</a></li><li><a href="/api/1.7.3">1.7.3</a></li><li><a href="/api/1.7.2">1.7.2</a></li><li><a href="/api/1.7.1">1.7.1</a></li><li><a href="/api/1.7.0">1.7.0</a></li><li><a href="/api/1.6.2">1.6.2</a></li><li><a href="/api/1.6.1">1.6.1</a></li><li><a href="/api/1.6.0">1.6.0</a></li><li><a href="/api/1.5.0">1.5.0</a></li><li><a href="/api/1.4.0">1.4.0</a></li><li><a href="/api/1.3.0">1.3.0</a></li><li><a href="/api/1.2.0">1.2.0</a></li><li><a href="/api/1.1.0">1.1.0</a></li><li><a href="/api/1.0.3">1.0.3</a></li><li><a href="/api/1.0.2">1.0.2</a></li><li><a href="/api/1.0.1">1.0.1</a></li><li><a href="/api/1.0.0">1.0.0</a></li><li><a href="/api/0.16.0">0.16.0</a></li><li><a href="/api/0.15.9">0.15.9</a></li><li><a href="/api/0.15.8">0.15.8</a></li><li><a href="/api/0.15.7">0.15.7</a></li><li><a href="/api/0.15.6">0.15.6</a></li><li><a href="/api/0.15.5">0.15.5</a></li><li><a href="/api/0.15.4">0.15.4</a></li><li><a href="/api/0.15.3">0.15.3</a></li><li><a href="/api/0.15.2">0.15.2</a></li><li><a href="/api/0.15.1">0.15.1</a></li><li><a href="/api/0.15.0">0.15.0</a></li><li><a href="/api/0.14.2">0.14.2</a></li><li><a href="/api/0.14.1">0.14.1</a></li><li><a href="/api/0.14.0">0.14.0</a></li><li><a href="/api/0.13.3">0.13.3</a></li><li><a href="/api/0.11.4">0.11.4</a></li><li><a href="/api/0.13.2">0.13.2</a></li><li><a href="/api/0.13.1">0.13.1</a></li><li><a href="/api/0.13.0">0.13.0</a></li><li><a href="/api/0.12.0">0.12.0</a></li><li><a href="/api/0.11.3">0.11.3</a></li><li><a href="/api/0.11.2">0.11.2</a></li><li><a href="/api/0.11.1">0.11.1</a></li><li><a href="/api/0.11.0">0.11.0</a></li><li><a href="/api/0.10.1">0.10.1</a></li><li><a href="/api/0.10.0">0.10.0</a></li><li><a href="/api/0.9.2">0.9.2</a></li><li><a href="/api/0.9.1">0.9.1</a></li><li><a href="/api/0.9.0">0.9.0</a></li><li><a href="/api/0.8.4">0.8.4</a></li><li><a href="/api/0.8.3">0.8.3</a></li><li><a href="/api/0.8.2">0.8.2</a></li><li><a href="/api/0.8.1">0.8.1</a></li><li><a href="/api/0.8.0">0.8.0</a></li><li><a href="/api/0.7.1">0.7.1</a></li><li><a href="/api/0.7.0">0.7.0</a></li><li><a href="/api/0.5.2">0.5.2</a></li><li><a href="/api/0.6.1">0.6.1</a></li><li><a href="/api/0.6.0">0.6.0</a></li><li><a href="/api/0.5.1">0.5.1</a></li><li><a href="/api/0.5.0">0.5.0</a></li><li><a href="/api/0.4.4">0.4.4</a></li><li><a href="/api/0.4.3">0.4.3</a></li><li><a href="/api/0.4.2">0.4.2</a></li><li><a href="/api/0.4.1">0.4.1</a></li><li><a href="/api/0.4.0">0.4.0</a></li><li><a href="/api/0.3.0">0.3.0</a></li><li><a href="/api/0.2.1">0.2.1</a></li><li><a href="/api/0.2.0">0.2.0</a></li><li><a href="/api/0.1.3">0.1.3</a></li><li><a href="/api/0.1.2">0.1.2</a></li><li><a href="/api/0.1.1">0.1.1</a></li><li><a href="/api/0.1.0">0.1.0</a></li><li><a href="/api/0.0.6">0.0.6</a></li><li><a href="/api/0.0.5">0.0.5</a></li><li><a href="/api/0.0.4">0.0.4</a></li><li><a href="/api/0.0.3">0.0.3</a></li><li><a href="/api/0.0.2">0.0.2</a></li><li><a href="/api/0.0.1">0.0.1</a></li></ul></div></div><nav><ul>
<li><a href="#server" class="section-closed">Server</a>

<ul style="display: none;">
<li><a href="#new-serveroptions"><code>new Server([options])</code></a></li>
<li><a href="#server-properties" class="section-closed">Server properties</a>

<ul style="display: none;">
<li><a href="#serverapp"><code>server.app</code></a></li>
<li><a href="#serverconnections"><code>server.connections</code></a></li>
<li><a href="#serverinfo"><code>server.info</code></a></li>
<li><a href="#serverload"><code>server.load</code></a></li>
<li><a href="#serverlistener"><code>server.listener</code></a></li>
<li><a href="#servermethods"><code>server.methods</code></a></li>
<li><a href="#servermime"><code>server.mime</code></a></li>
<li><a href="#serverplugins"><code>server.plugins</code></a></li>
<li><a href="#serverrealm"><code>server.realm</code></a></li>
<li><a href="#serverregistrations"><code>server.registrations</code></a></li>
<li><a href="#serverroot"><code>server.root</code></a></li>
<li><a href="#serversettings"><code>server.settings</code></a></li>
<li><a href="#serverversion"><code>server.version</code></a></li>
</ul></li>
<li><a href="#serverauthdefaultoptions"><code>server.auth.default(options)</code></a></li>
<li><a href="#serverauthschemename-scheme"><code>server.auth.scheme(name, scheme)</code></a></li>
<li><a href="#serverauthstrategyname-scheme-mode-options"><code>server.auth.strategy(name, scheme, [mode], [options])</code></a></li>
<li><a href="#serverauthteststrategy-request-next"><code>server.auth.test(strategy, request, next)</code></a></li>
<li><a href="#serverbindcontext"><code>server.bind(context)</code></a></li>
<li><a href="#servercacheoptions"><code>server.cache(options)</code></a></li>
<li><a href="#serverconnectionoptions"><code>server.connection([options])</code></a></li>
<li><a href="#serverdecoratetype-property-method-options"><code>server.decorate(type, property, method, [options])</code></a></li>
<li><a href="#serverdependencydependencies-after"><code>server.dependency(dependencies, [after])</code></a></li>
<li><a href="#serverexposekey-value"><code>server.expose(key, value)</code></a></li>
<li><a href="#serverexposeobj"><code>server.expose(obj)</code></a></li>
<li><a href="#serverextevents"><code>server.ext(events)</code></a></li>
<li><a href="#serverextevent-method-options"><code>server.ext(event, method, [options])</code></a></li>
<li><a href="#serverhandlername-method"><code>server.handler(name, method)</code></a></li>
<li><a href="#serverinitializecallback"><code>server.initialize(callback)</code></a></li>
<li><a href="#serverinjectoptions-callback"><code>server.inject(options, callback)</code></a></li>
<li><a href="#serverlogtags-data-timestamp"><code>server.log(tags, [data, [timestamp]])</code></a></li>
<li><a href="#serverlookupid"><code>server.lookup(id)</code></a></li>
<li><a href="#servermatchmethod-path-host"><code>server.match(method, path, [host])</code></a></li>
<li><a href="#servermethodname-method-options"><code>server.method(name, method, [options])</code></a></li>
<li><a href="#servermethodmethods"><code>server.method(methods)</code></a></li>
<li><a href="#serverpathrelativeto"><code>server.path(relativeTo)</code></a></li>
<li><a href="#serverregisterplugins-options-callback"><code>server.register(plugins, [options], callback)</code></a></li>
<li><a href="#serverrouteoptions"><code>server.route(options)</code></a></li>
<li><a href="#serverselectlabels"><code>server.select(labels)</code></a></li>
<li><a href="#serverstartcallback"><code>server.start(callback)</code></a></li>
<li><a href="#serverstatename-options"><code>server.state(name, [options])</code></a></li>
<li><a href="#serverstopoptions-callback"><code>server.stop([options], callback)</code></a></li>
<li><a href="#servertablehost"><code>server.table([host])</code></a></li>
<li><a href="#server-events" class="section-closed">Server events</a>

<ul style="display: none;">
<li><a href="#internal-events" class="section-closed">Internal events</a>

<ul style="display: none;">
<li><a href="#request-logs">Request logs</a></li>
<li><a href="#server-logs">Server logs</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#requests" class="section-closed">Requests</a>

<ul style="display: none;">
<li><a href="#request-lifecycle">Request lifecycle</a></li>
<li><a href="#route-configuration" class="section-closed">Route configuration</a>

<ul style="display: none;">
<li><a href="#route-options">Route options</a></li>
<li><a href="#route-public-interface">Route public interface</a></li>
</ul></li>
<li><a href="#path-parameters">Path parameters</a></li>
<li><a href="#path-matching-order" class="section-closed">Path matching order</a>

<ul style="display: none;">
<li><a href="#catch-all-route">Catch all route</a></li>
</ul></li>
<li><a href="#route-handler">Route handler</a></li>
<li><a href="#route-prerequisites">Route prerequisites</a></li>
<li><a href="#request-object" class="section-closed">Request object</a>

<ul style="display: none;">
<li><a href="#request-properties">Request properties</a></li>
<li><a href="#requestseturlurlstripTrailingSlashparserOptions"><code>request.setUrl(url, [stripTrailingSlash], [parserOptions])</code></a></li>
<li><a href="#requestsetmethodmethod"><code>request.setMethod(method)</code></a></li>
<li><a href="#requestlogtags-data-timestamp"><code>request.log(tags, [data, [timestamp]])</code></a></li>
<li><a href="#requestgetlogtags-internal"><code>request.getLog([tags], [internal])</code></a></li>
<li><a href="#requesttailname"><code>request.tail([name])</code></a></li>
<li><a href="#request-events">Request events</a></li>
</ul></li>
</ul></li>
<li><a href="#reply-interface" class="section-closed">Reply interface</a>

<ul style="display: none;">
<li><a href="#replyerr-result" class="section-closed"><code>reply([err], [result])</code></a>

<ul style="display: none;">
<li><a href="#response-object" class="section-closed">Response object</a>

<ul style="display: none;">
<li><a href="#response-object-redirect-methods">Response Object Redirect Methods</a></li>
<li><a href="#response-events">Response events</a></li>
</ul></li>
<li><a href="#error-response" class="section-closed">Error response</a>

<ul style="display: none;">
<li><a href="#error-transformation">Error transformation</a></li>
</ul></li>
<li><a href="#flow-control">Flow control</a></li>
</ul></li>
<li><a href="#replycontinuedata"><code>reply.continue([data])</code></a></li>
<li><a href="#replycloseoptions"><code>reply.close([options])</code></a></li>
<li><a href="#replyredirecturi"><code>reply.redirect(uri)</code></a></li>
</ul></li>
</ul></nav></div></div><footer role="contentinfo"><div class="content"><nav role="navigation"><ul class="unstyled"><li><a href="/updates" title="Latest Updates">Updates</a></li><li><a href="/tutorials" title="Tutorials">Tutorials</a></li><li><a href="/api" title="API Reference">API</a></li><li><a href="/community" title="Community">Community</a></li><li><a href="/plugins" title="Plugins">Plugins</a></li><li><a href="/resources" title="Resources">Resources</a></li><li><a href="https://github.com/hapijs/hapi" title="hapi on Github">Github</a></li><li><a href="https://twitter.com/hapijs" title="@hapijs on Twitter">Twitter</a></li><li><a href="/help">Need Help?</a></li></ul></nav><p>hapi is maintained by the <a href="https://github.com/orgs/hapijs/people">core team</a> with help of <a href="https://github.com/hapijs/hapi/graphs/contributors">our contributors</a>.</p></div></footer></body></html>